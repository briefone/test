<!--

 ▄▄▄       ██▓███   ██▓███       █████▒██▀███   ▄▄▄       ███▄ ▄███▓▓█████ 
▒████▄    ▓██░  ██▒▓██░  ██▒   ▓██   ▒▓██ ▒ ██▒▒████▄    ▓██▒▀█▀ ██▒▓█   ▀ 
▒██  ▀█▄  ▓██░ ██▓▒▓██░ ██▓▒   ▒████ ░▓██ ░▄█ ▒▒██  ▀█▄  ▓██    ▓██░▒███   
░██▄▄▄▄██ ▒██▄█▓▒ ▒▒██▄█▓▒ ▒   ░▓█▒  ░▒██▀▀█▄  ░██▄▄▄▄██ ▒██    ▒██ ▒▓█  ▄ 
 ▓█   ▓██▒▒██▒ ░  ░▒██▒ ░  ░   ░▒█░   ░██▓ ▒██▒ ▓█   ▓██▒▒██▒   ░██▒░▒████▒
 ▒▒   ▓▒█░▒▓▒░ ░  ░▒▓▒░ ░  ░    ▒ ░   ░ ▒▓ ░▒▓░ ▒▒   ▓▒█░░ ▒░   ░  ░░░ ▒░ ░
  ▒   ▒▒ ░░▒ ░     ░▒ ░         ░       ░▒ ░ ▒░  ▒   ▒▒ ░░  ░      ░ ░ ░  ░
  ░   ▒   ░░       ░░           ░ ░     ░░   ░   ░   ▒   ░      ░      ░   
      ░  ░                               ░           ░  ░       ░      ░  ░

by Johnny

-->

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>App Frame Demo</title>
  <link rel="icon" href="./favicon.png" sizes="128x128">
  <style>
    :root {
      --border: #DEE2E6;
      --secondary: #6C757D;
    }
    * {padding:0;margin:0;}
    html {font: normal 14px sans-serif;color:#333;}
    body {background:#f8f9fa;overflow:hidden;}

    #tabs {position:absolute;top:0;left:0;right:0;height:32px;background:#EFF1F4;display:flex;align-items: center;}
      .popwindow #tabs {display:none;}
      .tab {height:100%;font-size:11px;padding: 0 12px;color:var(--secondary);align-items: center;line-height:32px;cursor:pointer;display:flex;gap:4px;}
        .tab.current {background:white;color:#333;}

        .tab.closeable {position:relative;padding-left:24px;gap:8px;padding-right:8px;}
          .tab .btn.xbtn {width:16px;height:16px;border-radius:50%;padding:0;min-width:0;margin-top:-2px;}



        .tab.board::before {content:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12'%3E%3Cpath fill='%236C757D' fill-rule='evenodd' d='M2 1.75a1 1 0 00-1 1v6.5a1 1 0 001 1h8a1 1 0 001-1v-6.5a1 1 0 00-1-1H2zm.25 1A.25.25 0 002 3v6c0 .138.112.25.25.25h1.5A.25.25 0 004 9V3a.25.25 0 00-.25-.25h-1.5zM5 3a.25.25 0 01.25-.25h1.5A.25.25 0 017 3v6a.25.25 0 01-.25.25h-1.5A.25.25 0 015 9V3zm3.25-.25A.25.25 0 008 3v6c0 .138.112.25.25.25h1.5A.25.25 0 0010 9V3a.25.25 0 00-.25-.25h-1.5z' clip-rule='evenodd'/%3E%3C/svg%3E");position:absolute;left:8px;top:calc(50% - 8px);transform:translateY(-50%);width:12px;height:12px;}

        .tab.brief::before {content:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%236C757D' d='M22.389 2.22H1.61A.61.61 0 001 2.831v.611a.61.61 0 00.611.611h.611v10.39c0 .674.548 1.221 1.222 1.221h7.64v1.67L8.117 20.3a.611.611 0 000 .864l.432.432a.611.611 0 00.864 0L12 19.01l2.586 2.587a.611.611 0 00.865 0l.431-.433a.611.611 0 000-.864l-2.965-2.966v-1.67h7.639c.674 0 1.222-.547 1.222-1.222V4.053h.61a.611.611 0 00.612-.61V2.83a.611.611 0 00-.611-.611zm-2.445 11.611H4.056V4.053h15.888v9.778z'/%3E%3C/svg%3E");position:absolute;left:8px;top:calc(50% - 8px);transform:translateY(-50%);width:12px;height:12px;}


      .menubtn {height:100%;font-size:11px;padding: 0 12px;color:var(--secondary);align-items: center;line-height:32px;cursor:pointer;display:flex;gap:4px;}


    .row {display:flex;gap:4px;}
      .col {display:flex;flex-direction: column;width:100%;}
      .wrap {flex-wrap: wrap;}

    .tags {width:100%;}

    .tag {background:rgb(0 0 0 / 10%);color:rgb(0 0 0 / 65%);font-weight:600;text-transform:uppercase;font-size:11px;padding:2px 4px 1px;border-radius:2px;display:inline-block;}

    #conwrap {position:absolute;top:32px;left:0;right:0;bottom:0;}
      .clopen #conwrap {right: 337px;}
      .popwindow #conwrap {display:none;}

    #subnav {height:44px;position:absolute;top:0;left:0;right:0;background:white;border-bottom:1px solid #eee;display:flex;align-items:center;padding:0 8px;    justify-content: space-between;}
      .right {}

    input[type=text] {width:100%;height:28px;border:1px solid var(--border);border-radius:3px;text-indent: 8px;box-sizing: border-box;}

    .combobox {display:flex;}
      .combobox input {border-radius: 3px 0 0 3px;width:100%;}
      .combobox .btn {border-radius: 0 3px 3px 0;border:1px solid var(--border);margin-left:-1px;font-size:9px;background:white;}

    #cl {position:absolute;top:32px;right:0;bottom:0;width:336px;border-left:1px solid #eee;background:white;transform:translateX(100%);z-index:999999;}
    .popwindow #cl {top:0;left:0;width:auto;border:none;transform:translateX(0);}
    .clopen #cl {transform:translateX(0);}
      .filterbar, .editmodebar {position:absolute;top:0;left:0;right:0;height:44px;background:white;border-bottom:1px solid #eee;display:flex;gap:4px;padding:0 8px;align-items: center;}
        .editmodebar, .editmode .filterbar {display:none;}
        .editmode .editmodebar {display:flex;}
        .filterbar .searchbar {width:100%;}
        .filterbar .btn {}
      .cardlist {position:absolute;top:73px;left:0;right:0;bottom:0;overflow-y:scroll;}
        .popwindow .cardlist {bottom:0;top:45px;}

      .editmodebar {justify-content: space-between;}
        .editmodebar .left, .editmodebar .right {display:flex;gap:4px;}


    .btn {height:28px;min-width:28px;border-radius:3px;background:transparent;color:var(--secondary);display: flex;align-items: center;justify-content: center;padding:0 8px;box-sizing: border-box;font-weight:500;cursor:pointer;user-select:none;font-size:12px;}
      .btn svg {fill:var(--secondary);width:12px;height:12px;}
        .btn:hover {background:#ddd;}
        .btn:active {background:#ccc;}

      .btn.cta {background:#357EAC;color:white;}
        .btn.cta:hover {background:#2c6c94;}
        .btn.cta:active {background:#235e83;}

    .btn.on {background:var(--secondary);color:white;}
      .btn.on svg {fill:white;}

    .btn.floating {position:absolute;top:45px;left:0;right:0;border-radius:0;background:rgb(12, 90, 206);color:white;z-index:9999;}
      .popwindow .floating {display:none;}

    .menubtn {}
      .menubtn:hover {background:var(--border)}
      .menubtn.on {background:var(--border)}

    .pop {position:relative;}
      .popover {opacity:0;pointer-events: none;position:absolute;top:calc(100% + 4px);left:-40px;background:white;z-index:999999999999999;padding:4px 0;box-shadow: 0px 0px 0px 1px rgba(0, 0, 0, 0.05), 0px 3px 6px rgba(0, 0, 0, 0.08), 0px 8px 24px rgba(0, 0, 0, 0.15);border-radius:3px;min-width:160px;user-select:none;}
      .on > .popover {opacity:1;pointer-events: all;}
        .popover h6 {font-size:10px;font-weight:700;color:var(--secondary);text-transform: uppercase;padding:8px 12px 4px;line-height:1;}
        .popitem {padding:0 12px;line-height:28px;color:#222;}
          .popitem:hover {background:var(--border);}

            .popitem label {display:flex;gap:8px;align-items: center;}
          .pophover {position:relative;padding-right:32px;white-space: nowrap;}
            .pophover::before {content:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 14'%3E%3Cpath fill='%236C757D' d='M5.284 10.839c-.312-.305-.337-.73 0-1.103L7.907 7 5.284 4.264c-.337-.373-.312-.798 0-1.101.311-.306.838-.286 1.13 0 .293.284 3.152 3.286 3.152 3.286a.766.766 0 010 1.103s-2.86 3.001-3.152 3.287c-.292.285-.819.305-1.13 0z'/%3E%3C/svg%3E");position:absolute;right:8px;top:calc(50% - 3px);transform:translateY(-50%);width:14px;height:14px;}

        .popover hr {border:none;height:1px;margin:4px 0;background-color:var(--border)}

          .hoverpop {position:absolute;opacity:0;pointer-events: none;left:100%;top:-4px;}
            .pophover:hover > .hoverpop {opacity:1;pointer-events: all;}

    .card {cursor:grab;user-select:none;padding:6px 12px 6px 24px;position:relative;font-size:12px;display: flex;flex-direction: column;gap:4px;border-bottom:1px solid var(--border);}
      .card::before {content:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 6 10'%3E%3Crect width='2' height='2' fill='%236C757D' rx='1'/%3E%3Crect width='2' height='2' x='4' fill='%236C757D' rx='1'/%3E%3Crect width='2' height='2' x='4' y='4' fill='%236C757D' rx='1'/%3E%3Crect width='2' height='2' y='4' fill='%236C757D' rx='1'/%3E%3Crect width='2' height='2' y='8' fill='%236C757D' rx='1'/%3E%3Crect width='2' height='2' x='4' y='8' fill='%236C757D' rx='1'/%3E%3C/svg%3E");position:absolute;left:8px;top:50%;transform:translateY(-50%);width:6px;height:10px;}
      .card.hide {display:none;}
      .card.used {background:#66519114;}
      .keytag {background:#eee;color:#888;font-weight:600;text-transform:uppercase;font-size:11px;padding:2px 4px 1px;border-radius:2px;display:inline-block;align-self: center;}
      .mr {line-height:1.2;overflow:hidden;text-overflow: ellipsis;
   display: -webkit-box;
   -webkit-box-orient: vertical;
   -webkit-line-clamp: 2;}

        .card .expand {display:none;flex-direction: column;gap:16px;align-items: flex-start;padding:8px 0;}
        .card.expanded {box-shadow: inset 0 0 0 2px #7a61ff;}
        .expanded .expand {display:flex;}
          .expanded .tr, .expanded .mr, .expanded .br, .expanded .check {display:none;}

          .etr {display:flex;justify-content: space-between;width: 100%;gap:4px;}
            .etr .right {display:flex;}

          textarea {width:100%;height:120px;overflow:hidden;background:white;border:1px solid var(--border);border-radius:3px;padding:8px;box-sizing:border-box;font:normal 12px sans-serif;resize:none;}

            .btnrow {display:flex;}
            .label {font-size:12px;color:var(--secondary);margin-bottom:2px;}

        .card .check {display:none;position:absolute;left:6px;top:50%;transform:translateY(-50%);}
          .editmode .card .check {display:block;}
            .editmode .card::before {content:'';}

        .c4l .mr {-webkit-line-clamp: 4;}
      .br {display:flex;gap:4px 12px;flex-wrap: wrap;}

      .meta {display:flex;font-size:10px;color:var(--secondary);gap:4px;font-weight:700;}
        .meta .icon, .meta svg {width:12px;height:12px;fill:#777;}
        .meta .data {text-transform:uppercase;}

      .mousegrab {cursor:grabbing;}

      .dragcard {position:absolute;z-index:9999;width:200px;padding:8px;color:white;cursor:grabbing;user-select:none;border-radius:3px;}
        .dragcard.focused {box-shadow:0 0 0 2px #7B61FF;}
        .dragcard .mr {-webkit-line-clamp: 4;}


      #container {position:absolute;top:45px;left:0;right:0;bottom:0;}

        .view {display:none;flex-direction: row;gap:12px;padding:16px;max-width:100%;overflow-y:scroll;height:100%;box-sizing: border-box;}

        #container.home #home, #container.p1 #p1,#container.p2 #p2 {display:flex;}

          .list {width:232px;min-height:200px;padding:8px;border-radius:3px;flex-shrink:0;background:rgb(0 0 0 / 5%);box-sizing: border-box;display:flex;flex-direction: column;gap:4px;align-items: flex-start;user-select:none;align-self: flex-start;transition:background-color 25ms linear;}
          .list.hovering {background:#aa99ff71;}
          .list.draggingover {background:#aa99ff71;}
            .list.draggingover > * {pointer-events: none !important;}

        .listtag {background:rgb(0 0 0 / 10%);color:rgb(0 0 0 / 65%);font-weight:600;text-transform:uppercase;font-size:11px;padding:2px 4px 1px;border-radius:2px;display:inline-block;flex-grow: 0;}


      .logo {justify-content: center;}
        .logo svg {width:18px;height:18px;}

      .chev {width:12px;height:12px;fill:var(--secondary)}


        .meta {display:none;}
        .ctag .metatag, .ceditor .metaeditor, .cedited .metaedited, .cupdated .metaupdated, .ccreator .metacreator, .ccreated .metacreated, .creactions .metareactions, .ccomments .metacomments, .cuses .metauses, .cactor .metaactor, .csource .metasource, .cid .metaid {display:flex;}


        .deck {position:absolute;top:1px;left:0;bottom:0;width:180px;background:white;border-right:1px solid var(--border);}
          .deck .minislide {width:calc(100% - 24px);margin:12px;aspect-ratio: 16/9;border:1px solid var(--border);border-radius:4px;}
          .slide {width:calc(100vw - 600px);aspect-ratio: 16/9;max-height:calc(100vh - 120px);background-color: white;position:absolute;top:50%;left:calc(50%);transform:translate(calc(-50% + 90px), -50%);border:1px solid var(--border);}

      .cardactivity {color:var(--secondary);}
      .cardactions {display:flex;gap:4px;}

      .starttime {color:var(--secondary);}
        .starttime .row {align-items: center;gap:8px;}
          .starttime .row label {display:flex;align-items: center;gap:4px;}

  </style>
  <script src="../js/base.js"></script>
  <script src="../js/gator.js"></script>
</head>

<body class="clopen">
  <div id=wrapper>
    <div id=tabs>
      <div class="tab logo" data-view=home>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18">
          <path fill="#9DCAE7" d="M6.106 10.667L16.449.321H.32V6.11h5.785v4.558z"/>
          <path fill="#49A2DA" d="M7.333 11.894L17.679 1.55v16.127h-5.788v-5.784H7.333z"/>
        </svg>
      </div>
      <div class="menubtn planhome pop" data-view=planhome>Conquer the World
        <svg class=chev viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M5.41921 9.05756C5.94241 8.52236 6.67081 8.48036 7.31041 9.05756L12 13.554L16.6896 9.05756C17.3292 8.48036 18.0588 8.52236 18.5784 9.05756C19.1016 9.59156 19.068 10.494 18.5784 10.9956C18.0912 11.4972 12.9444 16.398 12.9444 16.398C12.684 16.6656 12.342 16.8 12 16.8C11.658 16.8 11.316 16.6656 11.0532 16.398C11.0532 16.398 5.90881 11.4972 5.41921 10.9956C4.92961 10.494 4.89601 9.59156 5.41921 9.05756Z"/>
        </svg>
        <div class=popover style="left:0;">
          <div class="popitem pophover">Plans

            <div class="hoverpop popover">
              <div class=popitem>Create new plan</div>
              <hr>
              <div class=popitem>Plan A</div>
              <div class=popitem>Plan B</div>
              <div class=popitem>Plan C</div>
            </div>
          </div>
          <hr>
          <div class="popitem pophover">Plan Conquer the World
            <div class="hoverpop popover">
              <div class=popitem>Properties</div>
              <div class=popitem>Share</div>
              <div class=popitem>Duplicate</div>
              <div class=popitem>Delete</div>
            </div>
          </div>
          <div class="popitem pophover">Boards

            <div class="hoverpop popover">
              <div class=popitem>Create new board</div>
              <hr>
              <div class=popitem>Phase I</div>
              <div class=popitem>Phase II</div>
              <div class=popitem>Phase III</div>
              <div class=popitem>RFI</div>
            </div>
          </div>
          <div class="popitem pophover">Timeline<div class="hoverpop popover">
            <div class=popitem>Create new timeline</div>
            <hr>
            <div class=popitem>Phase I</div>
            <div class=popitem>Phase II</div>
            <div class=popitem>Phase III</div>
            <div class=popitem>RFI</div>
          </div></div>
          <div class="popitem pophover">Cause & effect<div class="hoverpop popover">
            <div class=popitem>Create new cause & effect</div>
            <hr>
            <div class=popitem>Phase I</div>
            <div class=popitem>Phase II</div>
            <div class=popitem>Phase III</div>
            <div class=popitem>RFI</div>
          </div></div>
          <div class="popitem pophover">Briefs<div class="hoverpop popover">
            <div class=popitem>Create new brief</div>
            <hr>
            <div class=popitem>Phase I</div>
            <div class=popitem>Phase II</div>
            <div class=popitem>Phase III</div>
            <div class=popitem>RFI</div>
          </div></div>
          <div class="popitem pophover">Orders<div class="hoverpop popover">
            <div class=popitem>Create new orders</div>
            <hr>
            <div class=popitem>Phase I</div>
            <div class=popitem>Phase II</div>
            <div class=popitem>Phase III</div>
            <div class=popitem>RFI</div>
          </div></div>
          <hr>
          <div class="popitem pophover">Account<div class="hoverpop popover">
            <div class=popitem>Profile</div>
            <div class=popitem>Security</div>
            <hr>
            <div class=popitem>Logout</div>
          </div></div>
          <div class="popitem pophover">Team<div class="hoverpop popover">
            <div class=popitem>Add team member</div>
            <div class=popitem>View team</div>
          </div></div>
          <div class=popitem>Activity</div>
          <hr>
          <div class=popitem>Help</div>
        </div>
      </div>
      <div class="tab board closeable current" data-view=p1>
        Phase I
        <div class="btn xbtn">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M14.87 12.002l4.3-4.3a1.352 1.352 0 000-1.91l-.956-.956a1.352 1.352 0 00-1.912 0l-4.3 4.3-4.3-4.3a1.352 1.352 0 00-1.91 0l-.956.955a1.352 1.352 0 000 1.912l4.3 4.3-4.3 4.3a1.352 1.352 0 000 1.91l.955.956a1.352 1.352 0 001.912 0l4.3-4.3 4.3 4.3a1.352 1.352 0 001.91 0l.956-.955a1.352 1.352 0 000-1.912l-4.3-4.3z"/>
          </svg>
        </div>
      </div>
      <div class="tab brief closeable" data-view=p2>Mission Brief<div class="btn xbtn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M14.87 12.002l4.3-4.3a1.352 1.352 0 000-1.91l-.956-.956a1.352 1.352 0 00-1.912 0l-4.3 4.3-4.3-4.3a1.352 1.352 0 00-1.91 0l-.956.955a1.352 1.352 0 000 1.912l4.3 4.3-4.3 4.3a1.352 1.352 0 000 1.91l.955.956a1.352 1.352 0 001.912 0l4.3-4.3 4.3 4.3a1.352 1.352 0 001.91 0l.956-.955a1.352 1.352 0 000-1.912l-4.3-4.3z"/>
        </svg>
      </div></div>
    </div>
    <div id=conwrap>
      <div id="subnav">
        <div class=left></div>
        <div class="right">
          <div class="btn toggle clbtn on" data-class=clopen>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12">
              <path fill-rule="evenodd" d="M3.162 1.714a.839.839 0 00-.841.837v5.017c0 .462.376.836.84.836h7.57c.464 0 .84-.374.84-.836V2.55a.839.839 0 00-.84-.837H3.16zm.105 1.255a.105.105 0 00-.105.104V3.7c0 .058.047.105.105.105h2.312a.105.105 0 00.106-.105v-.627a.105.105 0 00-.106-.104H3.267zm-.105 1.777c0-.058.047-.105.105-.105h7.358c.058 0 .105.047.105.105v.627a.105.105 0 01-.105.104H3.267a.105.105 0 01-.105-.104v-.627zm.105 1.568a.105.105 0 00-.105.104v.627c0 .058.047.105.105.105h6.517a.105.105 0 00.105-.105v-.627a.105.105 0 00-.105-.104H3.267z" clip-rule="evenodd"/>
              <path d="M1.48 3.596h-.105a.943.943 0 00-.947.94v4.809c0 .52.424.94.947.94h7.358a.943.943 0 00.946-.94V9.24H2.741A1.258 1.258 0 011.48 7.986v-4.39z"/>
            </svg>
          </div>
        </div>
      </div>

      <div id=container class=p1>

        <div id=p2 class=view>
          <div class=deck>
            <div class=minislide></div>
          </div>
          <div class=slide>

          </div>
        </div>

        <div id=p1 class=view>
          <div class=list>
            <div class=listtag>List tag</div>
          </div>
          <div class=list>
            <div class=listtag>List tag</div>
          </div>
          <div class=list>
            <div class=listtag>List tag</div>
          </div>
          <div class=list>
            <div class=listtag>List tag</div>
          </div>
          <div class=list>
            <div class=listtag>List tag</div>
          </div>
          <div class=list>
            <div class=listtag>List tag</div>
          </div>
          <div class=list>
            <div class=listtag>List tag</div>
          </div>
          <div class=list>
            <div class=listtag>List tag</div>
          </div>
          <div class=list>
            <div class=listtag>List tag</div>
          </div>
          <div class=list>
            <div class=listtag>List tag</div>
          </div>
        </div>
      </div>
    </div>

    <div id=cl class="">
      <div class="btn floating" onclick="openpop();">Open in new window</div>
      <div class=editmodebar>
        <div class=left>
          <input type=checkbox style="margin-left:-2px" />
        </div>
        <div class=right>
          <div class="btn">
            Copy
          </div>
          <div class="btn">
            Merge
          </div>
          <div class="btn">
            Delete
          </div>
          <div class="btn cta" onclick="document.getElementById('cl').classList.remove('editmode')">
            Done
          </div>
        </div>
      </div>
      <div class=filterbar>
        <input class=searchbar placeholder="Filter cards..." type=text />
        <div class="btn pop" id=sort>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12">
            <path d="M5.781 8.063H4.75V1.53a.344.344 0 00-.344-.343H3.72a.344.344 0 00-.344.343v6.532H2.344a.344.344 0 00-.243.586l1.719 2.063a.343.343 0 00.486 0l1.719-2.063a.344.344 0 00-.244-.586zM10.15 3.35L8.43 1.288a.344.344 0 00-.486 0L6.225 3.351a.344.344 0 00.244.587h1.03v6.53a.344.344 0 00.345.345h.687a.344.344 0 00.344-.344V3.938h1.031c.305 0 .46-.37.243-.587z" />
          </svg>

          <div class=popover>
            <h6>Sort</h6>
            <div class=popitem>Description</div>
            <div class=popitem>Key tag</div>
            <div class=popitem>Date created</div>
            <div class=popitem>Date modified</div>
            <div class="popitem pophover">
              More
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class=popitem>Reaction</div>
                <div class=popitem>Edits</div>
                <div class=popitem>Uses</div>
              </div>
            </div>
            <hr>
            <div class=popitem>Ascending</div>
            <div class=popitem>Descending</div>
          </div>
        </div>
        <div class="btn pop">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12">
            <path d="M10.984.5H1.016a.516.516 0 00-.364.88l3.973 3.974v4.427c0 .168.082.326.22.423l1.719 1.202a.516.516 0 00.811-.422v-5.63l3.973-3.974a.516.516 0 00-.364-.88z"/>
          </svg>

          <div class=popover style="left:-72px;">
            <h6>Filter</h6>
            <div class="popitem pophover">
              Tag
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class=popitem>Logisitics</div>
                <div class=popitem>Fact</div>
                <div class=popitem>RFI</div>
                <div class=popitem>Operation</div>
                <div class=popitem>Combat</div>
                <div class=popitem>Enemy</div>
                <div class=popitem>Danger</div>
                <div class=popitem>Neutral</div>
              </div>
            </div>
            <div class="popitem pophover">
              Author
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class=popitem>Dave Brown</div>
                <div class=popitem>Mike Jones</div>
                <div class=popitem>Lindsay Weir</div>
                <div class=popitem>Ashley Smith</div>
                <div class=popitem>Ted Turner</div>
                <div class=popitem>Fred Baker</div>
              </div>
            </div>
            <div class="popitem pophover">
              Editor
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class=popitem>Dave Brown</div>
                <div class=popitem>Mike Jones</div>
                <div class=popitem>Lindsay Weir</div>
                <div class=popitem>Ashley Smith</div>
                <div class=popitem>Ted Turner</div>
                <div class=popitem>Fred Baker</div>
              </div>
            </div>
            <div class="popitem pophover">
              Reaction
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class=popitem>Approved</div>
                <div class=popitem>Important</div>
                <div class=popitem>Unclear</div>
                <div class=popitem>Challenged</div>
              </div>
            </div>
            <div class="popitem pophover">
              Use
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class="popitem pophover">
                  Board
                  <div class="hoverpop popover" style="left:-156px;top:-4px;">
                    <div class=popitem>Board 1</div>
                    <div class=popitem>Board 2</div>
                    <div class=popitem>Board 3</div>
                    <div class=popitem>Board 4</div>
                  </div>
                </div>
                <div class="popitem pophover">
                  Cause and effect
                  <div class="hoverpop popover" style="left:-156px;top:-4px;">
                    <div class=popitem>CE 1</div>
                    <div class=popitem>CE 2</div>
                    <div class=popitem>CE 3</div>
                    <div class=popitem>CE 4</div>
                  </div>
                </div>
                <div class="popitem pophover">Timeline
                  <div class="hoverpop popover" style="left:-156px;top:-4px;">
                    <div class=popitem>T 1</div>
                    <div class=popitem>T 2</div>
                    <div class=popitem>T 3</div>
                    <div class=popitem>T 4</div>
                  </div>
                </div>
                <div class="popitem pophover">Brief
                  <div class="hoverpop popover" style="left:-156px;top:-4px;">
                    <div class=popitem>B 1</div>
                    <div class=popitem>B 2</div>
                    <div class=popitem>B 3</div>
                    <div class=popitem>B 4</div>
                  </div>
                </div>
                <div class="popitem pophover">Orders
                  <div class="hoverpop popover" style="left:-156px;top:-4px;">
                    <div class=popitem>O 1</div>
                    <div class=popitem>O 2</div>
                    <div class=popitem>O 3</div>
                    <div class=popitem>O 4</div>
                  </div>
                </div>
              </div>
            </div>
            <hr>
            <div class=popitem>Clear filters</div>
          </div>
        </div>
        <div class="btn pop">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12">
            <path d="M11.36 7.382l-.987-.57c.1-.538.1-1.09 0-1.628l.987-.57a.28.28 0 00.127-.325 5.775 5.775 0 00-1.267-2.193.279.279 0 00-.343-.054l-.987.57A4.371 4.371 0 007.48 1.8V.66c0-.13-.09-.243-.217-.27a5.82 5.82 0 00-2.53 0 .278.278 0 00-.218.27v1.141a4.51 4.51 0 00-1.408.814l-.985-.57a.275.275 0 00-.343.053A5.74 5.74 0 00.513 4.29c-.04.125.014.26.127.325l.987.57c-.1.538-.1 1.09 0 1.628l-.987.57a.28.28 0 00-.127.325A5.776 5.776 0 001.78 9.902a.279.279 0 00.343.053l.987-.57c.415.357.892.633 1.408.814v1.14c0 .13.09.244.218.272.85.19 1.721.18 2.53 0a.278.278 0 00.218-.271v-1.141a4.51 4.51 0 001.408-.814l.987.57a.275.275 0 00.343-.053 5.74 5.74 0 001.267-2.193.286.286 0 00-.13-.327zm-5.361.47a1.857 1.857 0 01-1.854-1.854c0-1.023.832-1.855 1.854-1.855 1.021 0 1.853.832 1.853 1.855A1.857 1.857 0 016 7.853z"/>
          </svg>

          <div class=popover style="left:-104px">
            <h6>Customize</h6>
            <div class=popitem>
              <label>
                <input type=radio class=cradio id=c2l value=c2l name="lines" /> 2 lines
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=radio class=cradio id=c4l value=c4l name=lines /> 4 lines
              </label>
            </div>
            <hr>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=ctag value=ctag /> Tag count
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=ceditor value=ceditor /> Last editor
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=cupdated value=cupdated /> Last Updated
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=ccreator value=ccreator /> Creator
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=ccreated value=ccreated  /> Created
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=creactions value=creactions /> Reactions
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=ccomments value=ccomments /> Comments
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=cuses value=cuses /> Uses
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox  class=ctoggle id=cactor value=cactor /> Actor
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=csource value=csource /> Source
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=cid value=cid /> ID
              </label>
            </div>
          </div>
        </div>
        <div class="btn" onclick="document.getElementById('cl').classList.add('editmode')">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M1 3a2 2 0 012-2h18a2 2 0 012 2v18a2 2 0 01-2 2H3a2 2 0 01-2-2V3zm8.969 14.35L5.5 12.883a.688.688 0 010-.972l.972-.973a.687.687 0 01.973 0l3.01 3.01 6.1-6.1a.688.688 0 01.973 0l.972.973a.687.687 0 010 .972l-7.559 7.559a.687.687 0 01-.972 0z" clip-rule="evenodd"/>
          </svg>
        </div>
      </div>
      <div class=cardlist>

      </div>
    </div>
  </div>

  <div id=templates style="display:none;">
    <div id=reactions class="reactions">
      <div class=label>Reactions</div>
      <div class=btnrow>
        <div class="btn"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 17 16">
          <path fill="#288F63" fill-rule="evenodd" d="M1.606 8a6.67 6.67 0 016.667-6.667A6.67 6.67 0 0114.94 8a6.67 6.67 0 01-6.667 6.667A6.67 6.67 0 011.606 8zm2.334.588l2.979 2.98c.179.178.47.178.648 0l5.04-5.04a.458.458 0 000-.648l-.649-.648a.458.458 0 00-.648 0L7.243 9.299 5.236 7.292a.458.458 0 00-.648 0l-.648.648a.458.458 0 000 .648z" clip-rule="evenodd"/>
        </svg></div>
        <div class="btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 16">
          <path fill="#1885d8" d="M8.19 1.333a.6.6 0 00-.552.37L6.004 5.596l-4.181.358a.601.601 0 00-.52.417.61.61 0 00.178.645l3.175 2.778-.954 4.129a.61.61 0 00.232.628.595.595 0 00.663.028l3.593-2.19 3.594 2.19a.595.595 0 00.662-.028.61.61 0 00.232-.628l-.954-4.129L14.9 7.016a.61.61 0 00.177-.645.601.601 0 00-.52-.417l-4.18-.358-1.634-3.893a.6.6 0 00-.553-.37z"/>
        </svg></div>
        <div class="btn"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 17 16">
          <path fill="#F36D07" fill-rule="evenodd" d="M13.458 1.333H3.088c-.822 0-1.482.6-1.482 1.334V12c0 .733.66 1.333 1.482 1.333H6.05l2.11 1.9c.064.057.16.057.224 0l2.11-1.9h2.963c.815 0 1.482-.6 1.482-1.333V2.667c0-.734-.667-1.334-1.482-1.334zM5.606 5.767H7.11c.034-.627.456-1.032 1.094-1.032.632 0 1.054.383 1.054.91s-.216.8-.932 1.227c-.766.45-1.071.949-1 1.82l.012.322h1.47V8.72c0-.544.206-.816.944-1.243.783-.461 1.188-1.044 1.188-1.882 0-1.265-1.05-2.148-2.636-2.148-1.704 0-2.67.955-2.698 2.32zm2.487 5.9c.505 0 .91-.383.91-.872 0-.488-.405-.871-.91-.871-.5 0-.905.383-.905.871 0 .489.405.872.905.872z" clip-rule="evenodd"/>
        </svg></div>
        <div class="btn"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 17 16">
          <path fill="#E83F45" d="M3.273 2c0-.184.15-.333.334-.333h5.666l.667 1h3c.184 0 .333.149.333.333v6c0 .184-.149.333-.333.333H8.773l-.833-1H5.273V14c0 .184-.149.333-.333.333H3.607A.333.333 0 013.273 14V2z"/>
        </svg></div>
      </div>
    </div>

    <div id=tags class="tags">
      <div class=label>Tags</div>
      <div class=combobox>
        <input type=text /><div class="btn">▼</div>
      </div>
    </div>

    <div id=uses class="uses">
      <div class=label>Uses</div>
      <div class="row wrap">
        <div class=tag>Phase I</div>
        <div class=tag>Phase II</div>
        <div class=tag>Phase III</div>
        <div class=tag>Warno</div>
        <div class=tag>Brief I</div>
      </div>
    </div>

    <div id=actorsource class="actorsource">
      <div class=row>
        <div class=col>
          <div class=label>Actor</div>
          <input type=text />
        </div>
        <div class=col>
          <div class=label>Source</div>
          <input type=text />
        </div>
      </div>
    </div>

    <div id=starttime class="starttime">
      <div class=label>Start time</div>
      <div class=row>
        <label><input type=radio name=st checked /> Auto</label>
        <label><input type=radio name=st  /> Relative</label>
        <label><input type=radio name=st  /> Absolute</label>
      </div>
    </div>

    <div id=duration class="duration" style="width:100%;">
      <div class=label>Duration</div>
      <input type=text style="width:100%;" />
    </div>

    <div id=cardactivity class=cardactivity>
      Updated <u>5 minutes ago</u>
    </div>

    <div id=cardactions class=cardactions>
      <div class=btn>Comment</div>
      <div class=btn>Lock</div>
      <div class=btn>Activity</div>
    </div>

  </div>
  <script>
    function carddrag(e){
      if ( e.which == 3 || this.draggable ){
        return;
      }
      let t = this;
      let dragcard = false;
      let dragged = false;
      let moved = false;

      let sx = e.clientX;
      let sy = e.clientY;

      let ol = 0;
      let ot = 0;

      let text = this.getElementsByClassName('mr')[0].cloneNode(true);
      let keytag = this.getElementsByClassName('keytag')[0];

      let bg = window.getComputedStyle(keytag).backgroundColor;

      if (!this.classList.contains('focused')){
        document.getElementsByClassName('focused').removeclass('focused');
      }

      let used = t.classList.contains('used') ? true : false;

      document.body.classList.add('mousegrab');


      if ( !this.classList.contains('dragcard')){
        dragcard = document.createElement('div');
        dragcard.className = 'dragcard';
        dragcard.style.backgroundColor = bg;
        let kt = keytag.cloneNode(true);
        kt.style.backgroundColor = 'rgba(0,0,0,0.1)';
        dragcard.style.opacity = 0;
        dragcard.style.zIndex = 999999999999;
        dragcard.dataset.id = this.id;
        dragcard.appendChild(kt);
        dragcard.appendChild(text);
        document.body.appendChild(dragcard);
      } else {
        let c = this.cloneNode(true);
        document.body.appendChild(c);
        dragcard = c;
        bg = window.getComputedStyle(c).backgroundColor;

        ol = this.offset().x - sx;
        ot = this.offset().y - sy;

        this.style.opacity = 0;
      }

      let x = e.clientX + ol;
      let y = e.clientY + ot;

      dragcard.style.pointerEvents = 'none';
      dragcard.style.position = 'absolute';
      dragcard.style.cursor = 'grabbing';

      dragcard.style.left = x +'px';
      dragcard.style.top = y +'px';

      function move(e){
        // if ( t.classList.contains('expanded')){
        //   return;
        // }
        let x = e.clientX;
        let y = e.clientY;
        let nx = Math.abs(sx - x);
        let ny = Math.abs(sy - y);

        if ( !dragged && Math.max(nx, ny) > 5 ){
          dragcard.style.opacity = 1;
          dragged = true;
          t.classList.add('used');
        } else if (!dragged ){
          return;
        }

        if (!moved && Math.max(nx, ny) > 5 ){
          moved = true;
        }

        dragcard.style.left = x + ol +'px';
        dragcard.style.top = y + ot +'px';

        

        let tars = document.elementsFromPoint(e.clientX, e.clientY);



        tars.forEach(tar => {
          if ( tar.classList.contains('list')){
            if ( !tar.classList.contains('hovering')){
              let hovering = document.getElementsByClassName('list hovering');

              while(hovering[0]){
                hovering[0].removeAttribute('style');
                hovering[0].classList.remove('hovering');
              }
              tar.classList.add('hovering');

              if ( bg.indexOf('rgb') >= 0 ){
                let rgb = bg.replace('rgb(', '').replace(')', '').split(',');
                tar.style.backgroundColor = 'rgba(' + rgb[0] + ',' + rgb[1] + ',' + rgb[2] + ', 0.3)';
              }
            }

          }
        });
      }

      function end(e){
        document.removeEventListener('mousemove', move);
        document.removeEventListener('mouseup', end);

        document.body.classList.remove('mousegrab');

        let tars = document.elementsFromPoint(e.clientX, e.clientY);

        tars.forEach(tar => {
          let slide = tar.classList.contains('slide');
          if ( tar.classList.contains('list') || slide){
            if (tar == t.getparent('list')){
              return;
            }
            let cc = dragcard.cloneNode(true);
            cc.style.position = 'static';
            cc.style.pointerEvents = 'all';
            cc.style.cursor = 'grab';
            cc.style.zIndex = 9999;
            cc.classList.add('focused');

            if ( slide ){
              cc.style.position = 'absolute';
              cc.style.top = e.clientY -77 + ot + 'px';
              cc.style.left = e.clientX +ol+ 'px';
              tar.parentElement.appendChild(cc);
            } else {
              tar.appendChild(cc);
            }

            
            used = true;
          }
        });

        dragcard.remove();
        let hovering = document.getElementsByClassName('list hovering');

        while(hovering[0]){
          hovering[0].removeAttribute('style');
          hovering[0].classList.remove('hovering');
        }

        if ( !used ){
          t.classList.remove('used');
          t.style.opacity = 1;
        } else if ( t.classList.contains('dragcard')){
          t.remove();
        }

        if ( !moved ){
          console.log('click');

          document.getElementsByClassName('expanded').removeclass('expanded');

          if(t.classList.contains('dragcard')){
            t.classList.add('focused');

            if ( document.getElementsByClassName('clbtn')[0].classList.contains('on')){
              let ccc = document.getElementById(t.dataset.id);
              ccc.classList.add('expanded');
              ccc.scrollIntoViewIfNeeded(false);

              ta.call(ccc.getElementsByTagName('textarea')[0]);
            }
          } else {
            t.classList.add('expanded');
            ta.call(t.getElementsByTagName('textarea')[0]);
            t.scrollIntoViewIfNeeded(false);
          }
        }
      }

      document.addEventListener('mousemove', move);
      document.addEventListener('mouseup', end);
    }

    function makecards(c){
      let cl = document.getElementById('cl').getElementsByClassName('cardlist')[0];

      let tags = [{color: '#003f5c', text: 'logisitics'}, {color: '#2f4b7c', text: 'fact'}, {color: '#665191', text: 'RFI'}, {color: '#a05195', text: 'Operation'}, {color: '#d45087', text: 'combat'}, {color: '#f95d6a', text: 'enemy'}, {color: '#ff7c43', text: 'danger'}, {color: '#ffa600', text: 'neutral'}, ];

      for(let i=0;i<c;i++){
        let card = document.createElement('div');
        let tr = document.createElement('div');
        let mr = document.createElement('div');
        let check = document.createElement('input');

        let expand = document.createElement('div');
        let etag = document.createElement('div');
        let etext = document.createElement('textarea');
        let euses = document.getElementById('uses').cloneNode(true);
        let ereact = document.getElementById('reactions').cloneNode(true);
        let etags = document.getElementById('tags').cloneNode(true);
        let eas = document.getElementById('actorsource').cloneNode(true);
        let est = document.getElementById('starttime').cloneNode(true);
        let ed = document.getElementById('duration').cloneNode(true);
        let ecs = document.getElementById('cardactivity').cloneNode(true);
        let eca = document.getElementById('cardactions').cloneNode(true);

        let minb = document.createElement('div');
        let men = document.createElement('div');
        let rt = document.createElement('div');
        let etr = document.createElement('div');

        ereact.removeAttribute('id');
        euses.removeAttribute('id');
        etags.removeAttribute('id');
        eas.removeAttribute('id');
        est.removeAttribute('id');
        ed.removeAttribute('id');
        ecs.removeAttribute('id');
        eca.removeAttribute('id');

        etext.className = 'etext';

        card.className = 'card';
        let id = 'c-' + i;
        card.dataset.id = id;
        card.id = id;

        tr.className = 'tr';
        mr.className = 'mr';

        expand.className = 'expand';

        let kt = document.createElement('div');
        kt.className = 'keytag';
        let tag = tags.random();
        kt.style.backgroundColor = tag.color;
        kt.style.color = 'white';

        check.type = 'checkbox';
        check.className = 'check';

        rt.className = 'right';
        men.className = 'btn menubtn';
        minb.className = 'btn minbtn';
        etr.className = 'etr';

        minb.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 352H48c-26.5 0-48 21.5-48 48v32c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-32c0-26.5-21.5-48-48-48z"></path></svg>`;
        men.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"></path></svg>`

        minb.onclick = function(){ this.getparent('expanded').classList.remove('expanded'); };

        let content = generate();

        kt.appendChild(document.createTextNode(tag.text));

        etag = kt.cloneNode(true);

        rt.appendChild(minb);
        rt.appendChild(men);

        tr.appendChild(kt);

        mr.appendChild(document.createTextNode(content));

        etext.value = content;

        let meta = makemeta(i);

        card.appendChild(tr);
        card.appendChild(mr);
        card.appendChild(meta);
        card.appendChild(check);

        etr.appendChild(etag);
        etr.appendChild(rt);

        expand.appendChild(etr);
        expand.appendChild(etext);
        expand.appendChild(ereact);
        expand.appendChild(etags);
        expand.appendChild(euses);
        expand.appendChild(eas);
        expand.appendChild(est);
        expand.appendChild(ed);
        expand.appendChild(ecs);
        expand.appendChild(eca);

        card.appendChild(expand);

        cl.appendChild(card);
      }
    }

    function makemeta(id){
      let wrap = document.createElement('div');
      wrap.className = 'br';

      let metas = [{class: 'metatag', label:[1,2,3,4,5,6,7,8,9,0], path: 'M1 11.833v-8.77C1 1.923 1.923 1 3.063 1h8.77c.547 0 1.072.217 1.459.604l9.104 9.104a2.063 2.063 0 010 2.917l-8.77 8.77a2.063 2.063 0 01-2.918 0l-9.104-9.103A2.062 2.062 0 011 11.833zM5.813 3.75a2.062 2.062 0 100 4.125 2.062 2.062 0 000-4.125z'}, {class: 'metaeditor', label:['Dave B', 'Luke S', 'Mike J', 'Tony J', 'Ashley S', 'Fred B'], path: 'M16.377 5.394l3.445 3.445a.373.373 0 010 .527l-8.341 8.342-3.545.393a.743.743 0 01-.821-.821l.393-3.544 8.342-8.342a.373.373 0 01.527 0zm6.188-.875L20.7 2.655a1.494 1.494 0 00-2.109 0L17.24 4.007a.373.373 0 000 .528l3.445 3.445a.373.373 0 00.527 0l1.353-1.352c.58-.585.58-1.528 0-2.109zm-6.898 10.92v3.888H3.444V7.105h8.777a.47.47 0 00.325-.134l1.528-1.527a.458.458 0 00-.325-.783H2.833A1.834 1.834 0 001 6.494v13.444c0 1.013.821 1.834 1.833 1.834h13.445a1.834 1.834 0 001.833-1.834v-6.027a.46.46 0 00-.783-.324L15.8 15.114a.47.47 0 00-.133.325z'}, {class: 'metaupdated', label:['1D', '2W', '4D', '5D', '1M', '6M', '2M', '4D', '2D', '6D', '1W', '1H', '2H', '8H'], path: 'M12 1C5.923 1 1 5.923 1 12s4.923 11 11 11 11-4.923 11-11S18.077 1 12 1zm4.102 13.883l-.887 1.109a.71.71 0 01-.997.11l-2.972-2.204a1.773 1.773 0 01-.665-1.386v-6.9a.71.71 0 01.71-.709h1.419a.71.71 0 01.71.71V12l2.572 1.885a.708.708 0 01.11.998z'}, {class: 'metacreator', label:['Dave B', 'Luke S', 'Mike J', 'Tony J', 'Ashley S', 'Fred B'], path: 'M17.625 1l-2.75 1.375L12.125 1l-2.75 1.375L6.625 1v4.125h11V1zm-1.65 13.063h-.718a7.504 7.504 0 01-3.132.687 7.504 7.504 0 01-3.132-.688h-.718A5.775 5.775 0 002.5 19.837v1.1c0 1.14.923 2.063 2.063 2.063h15.125c1.139 0 2.062-.923 2.062-2.063v-1.1a5.775 5.775 0 00-5.775-5.774zm-3.85-1.376a5.5 5.5 0 005.5-5.5V6.5h-11v.688a5.5 5.5 0 005.5 5.5z'}, {class: 'metacreated', label:['1D', '2W', '4D', '5D', '1M', '6M', '2M', '4D', '2D', '6D', '1W'], path: 'M17.719 7.875H12.76l1.83-5.577A1.035 1.035 0 0013.595 1H7.406c-.515 0-.954.382-1.022.894L5.009 12.206c-.082.619.4 1.169 1.022 1.169h5.1l-1.98 8.357a1.03 1.03 0 001.895.752l7.562-13.062a1.03 1.03 0 00-.89-1.547z'}, {class: 'metareactions', label:['reacts'], path: 'M12 1.5C6.2 1.5 1.5 6.2 1.5 12S6.2 22.5 12 22.5 22.5 17.8 22.5 12 17.8 1.5 12 1.5zm5.987 16.487A8.41 8.41 0 0112 20.467a8.41 8.41 0 01-5.987-2.48A8.41 8.41 0 013.533 12c0-2.26.88-4.386 2.48-5.987A8.41 8.41 0 0112 3.533c2.26 0 4.386.88 5.987 2.48A8.41 8.41 0 0120.467 12a8.41 8.41 0 01-2.48 5.987zm-2.6-7.342c.75 0 1.355-.605 1.355-1.355s-.605-1.355-1.355-1.355-1.355.606-1.355 1.355c0 .75.606 1.355 1.355 1.355zm-6.774 0c.75 0 1.355-.605 1.355-1.355s-.606-1.355-1.355-1.355c-.75 0-1.355.606-1.355 1.355 0 .75.606 1.355 1.355 1.355zm8.23 2.71H7.156a.568.568 0 00-.571.635c.317 2.506 2.494 4.446 5.127 4.446h.576c2.633 0 4.81-1.94 5.127-4.446a.568.568 0 00-.572-.635z'}, {class: 'metacomments', label:[1 , 2 ,3 ,4 , 5,6,7,8,9], path: 'M19.778 2H4.222C2.99 2 2 2.9 2 4v14c0 1.1.989 2 2.222 2h4.445l3.166 2.85a.25.25 0 00.334 0L15.333 20h4.445C21 20 22 19.1 22 18V4c0-1.1-1-2-2.222-2zM8 8.65h2.256c.05-.94.683-1.548 1.64-1.548.949 0 1.582.575 1.582 1.366 0 .79-.325 1.198-1.399 1.84-1.149.674-1.607 1.423-1.498 2.73l.016.483h2.206v-.441c0-.816.308-1.224 1.415-1.865C15.393 10.524 16 9.65 16 8.393c0-1.898-1.573-3.222-3.954-3.222-2.556 0-4.004 1.432-4.046 3.48zm3.73 8.85c.757 0 1.365-.574 1.365-1.307s-.608-1.307-1.366-1.307c-.749 0-1.356.575-1.356 1.307 0 .733.607 1.307 1.356 1.307z'}, {class: 'metaactor', label:['Russia', 'China', 'Foreign', 'Domestic', 'Pacific', 'Kangaroos'], path: 'M5.813 9.6h-.825a.55.55 0 00-.55.55v3.3a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55v-3.3a.55.55 0 00-.55-.55zm-3.3 1.1h-.825a.55.55 0 00-.55.55v1.1a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55v-1.1a.55.55 0 00-.55-.55zm6.6-4.4h-.825a.55.55 0 00-.55.55v9.9a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55v-9.9a.55.55 0 00-.55-.55zm13.2 4.4h-.825a.55.55 0 00-.55.55v1.1a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55v-1.1a.55.55 0 00-.55-.55zm-3.3-5.5h-.826a.55.55 0 00-.55.55v12.1a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55V5.75a.55.55 0 00-.55-.55zm-3.3 2.2h-.825a.55.55 0 00-.55.55v7.7a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55v-7.7a.55.55 0 00-.55-.55zm-3.3-4.4h-.825a.55.55 0 00-.55.55v16.5a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55V3.55a.55.55 0 00-.55-.55z'}, {class: 'metasource', label:['Intel', 'Wiki', 'Internal', 'Warno', 'XXX'], path: 'M12 1C5.923 1 1 5.923 1 12s4.923 11 11 11 11-4.923 11-11S18.077 1 12 1zm0 4.258a3.903 3.903 0 110 7.807 3.903 3.903 0 010-7.807zm0 15.258a8.5 8.5 0 01-6.498-3.025c.834-1.57 2.466-2.652 4.369-2.652.106 0 .213.018.315.048.576.187 1.18.306 1.814.306a5.85 5.85 0 001.814-.306c.102-.03.209-.048.315-.048 1.903 0 3.535 1.082 4.369 2.652A8.5 8.5 0 0112 20.516z'}, {class: 'metaid'} ];

      for(let i=0;i<metas.length;i++){
        let a = metas[i];
        let l = a.label ? a.label.random() : 'unknown';
        let c = a.class;
        let p = a.path;

        if (c == 'metaid'){
          l = 'ID-' + (id+1);
        }

        let m = document.createElement('div');
        m.className = 'meta ' + c;
        m.title = c.replace('meta', '');

        if ( p ){
          let s = document.createElementNS("http://www.w3.org/2000/svg", "svg");
          let path = document.createElementNS("http://www.w3.org/2000/svg", 'path');

          s.setAttribute('viewBox', '0 0 24 24');
          path.setAttribute('d', a.path);

          s.appendChild(path);
          m.appendChild(s);
        }

        let d = document.createElement('div');
        d.className = 'data';

        d.appendChild(document.createTextNode(l));

        m.appendChild(d);

        wrap.appendChild(m);
      }

      return wrap;
    }

    function generate() {
        var output = '';
        for (var i = 0; i < (10 + Math.random() * 1000); i++) {
            for (var j = 0; j < Math.floor(Math.random() * 13); j++) {
                var char = 65 + (Math.random() * 26);
                output += String.fromCharCode(char);
            }
            switch (Math.floor(Math.random() * 8)) {
                default:
                  output = output.trim();
                    output += " ";
                    break;
            }
        }
        if (output.substring(output.length - 1, output.length) == " ") {
            output = output.slice(0, -1);
            var l = output.substring(output.length - 1, output.length);
            if(l == ","){
                output = output.slice(0, -1);
            }else if(l == "."){
                output += "";
            }else{
                output += "."
            }
        };
        return output.toLowerCase();
    }

    function togglebtn(){
      let on = this.classList.contains('on');
      let c = this.dataset.class;
      if ( on ){
        this.classList.remove('on');
        document.body.classList.remove(c);

      } else {
        document.getElementsByClassName('toggle on').removeclass('on');
        this.classList.add('on');
        document.body.classList.add(c);

        if ( c == 'clopen'){
          if ( window.clwindow){
            window.clwindow.close();
          }
        }
      }
    }

    function tab(){
      document.getElementsByClassName('tab current').removeclass('current');
      this.classList.add('current');

      let v = this.dataset.view;

      document.getElementById('container').className = v;
    }

    function filtercards(e){
      let v = this.value.toLowerCase().trim();

      console.log(v);

      let cards = document.getElementsByClassName('card');

      for(let i=0;i<cards.length;i++){
        let card = cards[i];
        let kt = card.getElementsByClassName('keytag')[0].innerText;
        let mr = card.getElementsByClassName('mr')[0].innerText;

        if ( kt.toLowerCase().indexOf(v) >= 0 ){
          card.classList.remove('hide');
        } else if (mr.toLowerCase().indexOf(v) >= 0){
          card.classList.remove('hide');
        } else {
          card.classList.add('hide');
        }
      }
    }

    function popbtn(){
      if (this.classList.contains('on')) {
        this.classList.remove('on');
      } else {
        document.getElementsByClassName('pop on').removeclass('on');
        this.classList.add('on');
      }

    }

    function ctoggle(e){
      let v = this.value;

      let cl = document.getElementById('cl');
      let x = false;
      if ( this.checked ){
        cl.classList.add(v);
        x = true;
      } else {
        cl.classList.remove(v);
      }

      localStorage[v] = x;
    }

    function cradio(e){
      let cl = document.getElementById('cl');
      let g = this.name;
      let r = document.getElementsByName(g);

      for(var i=0;i<r.length;i++){
        let rad = r[i];
        console.log(i, rad.checked);
        let v = rad.value;
        let x = false;
        if ( rad.checked ){
          cl.classList.add(v);
          x = true;
        } else {
          cl.classList.remove(v);
        }
        localStorage[v] = x;
      }
    }

    function bodyclick(e){
      let nonpop = false;
      let tars = document.elementsFromPoint(e.clientX, e.clientY);

        tars.forEach(tar => {
          if ( tar.classList.contains('popover') || tar.classList.contains('pop')){
            nonpop = true
            return;
          }
        });

        if ( !nonpop ){
          document.getElementsByClassName('pop on').removeclass('on');
        }
    }

    function restorecustom(){
      if (localStorage.ctag == 'true' || localStorage.ctag === undefined ) document.getElementById('ctag').click();
      if (localStorage.ceditor == 'true' || localStorage.ceditor === undefined ) document.getElementById('ceditor').click();
      if (localStorage.cupdated == 'true' ) document.getElementById('cupdated').click();
      if (localStorage.ccreator == 'true' ) document.getElementById('ccreator').click();
      if (localStorage.ccreated == 'true' ) document.getElementById('ccreated').click();
      if (localStorage.creactions == 'true' ) document.getElementById('creactions').click();
      if (localStorage.ccomments == 'true' ) document.getElementById('ccomments').click();
      if (localStorage.cuses == 'true' ) document.getElementById('cuses').click();
      if (localStorage.cactor == 'true' ) document.getElementById('cactor').click();
      if (localStorage.csource  == 'true') document.getElementById('csource').click();
      if (localStorage.cid == 'true' ) document.getElementById('cid').click();

      if (localStorage.c2l == 'true' || localStorage.c2l === undefined ) document.getElementById('c2l').click();
      if (localStorage.c4l == 'true' ) document.getElementById('c4l').click();
    }

    function keypress(e){
      console.log(e.keyCode);
      let k = e.keyCode;
      if ( k == 8 || k == 46){
        document.getElementsByClassName('dragcard focused').remove();
      }
    }

    function carddb(e){
      console.log('db');

      let clbtn = document.getElementsByClassName('clbtn')[0];
      if ( !clbtn.classList.contains('on') ){
        clbtn.click();

        let id = this.dataset.id;

        let card = document.getElementById(id);
        card.classList.add('expanded');

        card.scrollIntoViewIfNeeded(false);
      }
    }

    function ta(e){
      this.style.height = 0;
      let sh = this.scrollHeight;

      this.style.height = sh + 4 + 'px';

      if ( this.classList.contains('etext')){
        let c = this.getparent('card');
        let id = c.id;
        let cards = document.querySelectorAll(`[data-id="${id}"`);
        console.log(cards);
        for(var i=0;i<cards.length;i++){ 
          let mr = cards[i].getElementsByClassName('mr')[0];
          mr.empty();
          mr.appendChild(document.createTextNode(this.value))
        }
      }
    }

    function popwindow(){
      window.clwindow = window.open("./index.html#popwindow", "Card Library", "toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=336,height="+(window.screen.height- 300)+",top="+(100)+",left="+(window.screen.width-400));

      window.clwindow.onload = function(){
        let cl = window.clwindow.document.getElementsByClassName('cardlist')[0];
        let p = cl.parentElement;
        let clone = document.getElementsByClassName('cardlist')[0].cloneNode(true);
        cl.remove();
        p.appendChild(clone);

        let c = clone.getElementsByClassName('card');
        for(var i=0;i<c.length;i++){
          let card = c[i];
          card.draggable = true;
          card.classList.add('popcard');
        }
      }
      document.close();
    }

    function openpop(){
      if ( window.clwindow){
        window.clwindow.focus();
      }

      document.getElementsByClassName('clbtn')[0].click(); 
      popwindow();
    }

    function popcorn(){
      if ( location.hash == '#popwindow'){
        document.body.classList.add('popwindow');
        let c = document.getElementsByClassName('card');
        for(var i=0;i<c.length;i++){
          let card = c[i];
          card.draggable = true;
        }
      }

      window.onunload = function() {
        console.log('fsdfs')
        var win = window.opener;
          if (!win.closed) {
              win.someFunctionToCallWhenPopUpCloses();
          }
      };
    }

    function colorset(x){
      console.log('colorset', x)
    }

    function dragStart(e) {


      e.dataTransfer.effectAllowed = 'copy';
  
      e.dataTransfer.setData("application/my-app", e.target.id);
      e.dataTransfer.setDragImage(this, 0, 0);

      let t = this;


      document.addEventListener('mousemove', dragMove);
      document.addEventListener('mouseup', dragEnd);

      //this.classList.add(d);
      // container.style.cursor = 'move';

      function dragMove(e) {

     
      }

      function dragEnd(e) {
        
        document.removeEventListener('mousemove', dragMove);
        document.removeEventListener('mouseup', dragEnd);
        
      }
    }

    function handleDrop(e) {
      e.preventDefault();
      e.stopPropagation();

      let id = e.dataTransfer.getData('application/my-app');
      console.log(id , 'dsfsdf');

      document.getElementsByClassName('dragcard focused').removeclass('focused');


      let card = document.getElementById(id);
      let text = card.getElementsByClassName('mr')[0].cloneNode(true);
      let keytag = card.getElementsByClassName('keytag')[0];

      let bg = window.getComputedStyle(keytag).backgroundColor;


      let dragcard = document.createElement('div');
      dragcard.className = 'dragcard focused';
      dragcard.style.backgroundColor = bg;
      let kt = keytag.cloneNode(true);
      kt.style.backgroundColor = 'rgba(0,0,0,0.1)';
      dragcard.dataset.id = id;
      dragcard.style.position = 'static';
      dragcard.appendChild(kt);
      dragcard.appendChild(text);

      let slide = this.classList.contains('slide');

      if ( slide ){
        dragcard.style.position = 'absolute';
        dragcard.style.top = e.clientY -77 + 'px';
        dragcard.style.left = e.clientX + 'px';
        this.parentElement.appendChild(dragcard);
      } else {
        this.appendChild(dragcard);
      }

      this.classList.remove('draggingover');
      if ( window.clwindow){
        window.clwindow.focus();
      }
    }

    function handleDragOver(e) {
      e.preventDefault();
      
      e.dataTransfer.dropEffect = 'copy';
    }

    function handleDragEnter(e) {
      this.classList.add('draggingover');
    }

    function handleDragLeave(e) {
      this.classList.remove('draggingover');
    }

    function handleDragEnd(e) {
      this.classList.remove('draggingover');
    }

    function someFunctionToCallWhenPopUpCloses(){
      let clbtn = document.getElementsByClassName('clbtn')[0];
      if ( !clbtn.classList.contains('on')){
        clbtn.click();
      }
    }

    function cardclick(e){
      document.getElementsByClassName('expanded').removeclass('expanded');
      this.classList.add('expanded');
      this.scrollIntoViewIfNeeded(false);
    }

    Attach.on('dragstart', '.card', dragStart);

    Attach.on('dragover', '.list, .slide', handleDragOver);
    Attach.on('dragenter', '.list, .slide', handleDragEnter);
    Attach.on('dragleave', '.list, .slide', handleDragLeave);
    Attach.on('dragend', '.list, .slide', handleDragEnd);
    Attach.on('drop', '.list, .slide', handleDrop);


    Attach.on('click', '.popcard', cardclick);
    Attach.on('mousedown', '.card', carddrag);
    Attach.on('mousedown', '.dragcard', carddrag);
    Attach.on('dblclick', '.dragcard', carddb);
    Attach.on('click', '.toggle', togglebtn);
    Attach.on('click', '.pop', popbtn);
    Attach.on('click', '.tab', tab);
    Attach.on('click', '#wrapper', bodyclick);
    Attach.on('input', '.searchbar', filtercards);
    Attach.on('input', '.ctoggle', ctoggle);
    Attach.on('input', '.cradio', cradio);
    Attach.on('input', 'textarea', ta);
    document.addEventListener('keyup', keypress);

    makecards(40);
    restorecustom();
    popcorn();
  </script>
</body>
</html>
