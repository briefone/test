<!--

 ▄▄▄       ██▓███   ██▓███       █████▒██▀███   ▄▄▄       ███▄ ▄███▓▓█████ 
▒████▄    ▓██░  ██▒▓██░  ██▒   ▓██   ▒▓██ ▒ ██▒▒████▄    ▓██▒▀█▀ ██▒▓█   ▀ 
▒██  ▀█▄  ▓██░ ██▓▒▓██░ ██▓▒   ▒████ ░▓██ ░▄█ ▒▒██  ▀█▄  ▓██    ▓██░▒███   
░██▄▄▄▄██ ▒██▄█▓▒ ▒▒██▄█▓▒ ▒   ░▓█▒  ░▒██▀▀█▄  ░██▄▄▄▄██ ▒██    ▒██ ▒▓█  ▄ 
 ▓█   ▓██▒▒██▒ ░  ░▒██▒ ░  ░   ░▒█░   ░██▓ ▒██▒ ▓█   ▓██▒▒██▒   ░██▒░▒████▒
 ▒▒   ▓▒█░▒▓▒░ ░  ░▒▓▒░ ░  ░    ▒ ░   ░ ▒▓ ░▒▓░ ▒▒   ▓▒█░░ ▒░   ░  ░░░ ▒░ ░
  ▒   ▒▒ ░░▒ ░     ░▒ ░         ░       ░▒ ░ ▒░  ▒   ▒▒ ░░  ░      ░ ░ ░  ░
  ░   ▒   ░░       ░░           ░ ░     ░░   ░   ░   ▒   ░      ░      ░   
      ░  ░                               ░           ░  ░       ░      ░  ░

by Johnny Hunter
https://briefone.github.io/test/library/

-->

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>App Frame Test</title>
  <link rel="icon" href="./favicon.png" sizes="128x128">
  <style>
    :root {
      --ui1: #fff;
      --ui2: #f8f9fa;
      --ui3: #EFF1F4;
      --ui4: #DEE2E6;
      --ui5: #d6dbe0;
      --ui6:#637383;
      --ui7:#233853;
      --ui8:#212529;
      --ui9: black;

      --hover: var(--ui5);
      --background: var(--ui2);
      --tabs: var(--ui3);
      --border: var(--ui4);
      --secondary: var(--ui6);
      --text: var(--ui8);
      --textactive: var(--ui8);
      --tabactive: var(--subnav);
      --tabtext: var(--ui7);
      --subnav: var(--ui1);
      --cl: var(--ui1);
      --popover: var(--ui1);
      --toasttext: var(--ui1);
      --input: var(--ui2);
      --inputborder: var(--ui6);
      --tacolor: var(--ui9);
      --textarea: #eaedef;

      --middark: var(--ui7);

      --cta: #357EAC;
      --ctahover: #2c6c9a;
      --ctaactive:#235e83;

      --borderwidth: 1px;
      --subnavheight: 44px;

      --shadow: rgb(9 30 66 / 25%) 0px 4px 8px -2px, rgb(9 30 66 / 31%) 0px 0px 1px;
      --shadow-lg: 0px 0px 0px 1px rgba(0, 0, 0, 0.05), 0px 3px 6px rgba(0, 0, 0, 0.08), 0px 8px 24px rgba(0, 0, 0, 0.15);

      --font-fam: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";


      
      --select: #49A2DA;


      --handlegap: -4px;
      --handlecolor: var(--select);
      --handlesize: 8px;

     

      --selectgap: 0px;
      --selectwidth: 2px;

    }

    .dark {
      --ui1: #000;
      --ui2: #212529;
      --ui3: #444;
      --ui4: #6C757D;
      --ui5: #999;
      --ui6:#DEE2E6;
      --ui7: #EFF1F4;
      --ui8:#f8f9fa;
      --ui9: #fff;
    }

    * {padding:0;margin:0;}
    html {font: normal 14px var(--font-fam);color:var(--text);}
    body {background:var(--background);overflow:hidden;}
    input, textarea, select {font: normal 12px var(--font-fam);color:var(--text);outline:none;}
    input:focus, textarea:focus {outline: 2px solid #0063FF;outline-offset:-2px;background-color:#0062ff17 !important;}

    #tabs {position:absolute;top:0;left:0;right:0;height:32px;background:var(--tabs);display:flex;align-items: center;justify-content: space-between;user-select: none;}
      #tabs .left {width:calc(100% - 32px);}
      #tabwrap {display:flex;width:100%;}
        #tabwrap::-webkit-scrollbar {display: none;}
      .popwindow #tabs, .popwindow .popout {display:none;}
      .tab {height:100%;min-height:32px;font-size:11px;padding: 0 12px;color:var(--tabtext);align-items: center;line-height:32px;cursor:pointer;display:flex;gap:4px;white-space:nowrap;}
        .tab:hover {background:var(--border);}
        .tab.current {background:var(--tabactive);color:var(--textactive);}

        .tab.closeable {position:relative;padding-left:24px;gap:8px;padding-right:8px;}
          .tab .btn.xbtn {width:16px;height:16px;border-radius:50%;padding:0;min-width:0;}

          .left {display:flex;}

          .tab::before {position:absolute;left:8px;top:calc(50% + 0.5px);transform:translateY(-50%);width:12px;height:12px;}

        .tab.board::before {content:'';background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12'%3E%3Cpath fill='%236C757D' fill-rule='evenodd' d='M2 1.75a1 1 0 00-1 1v6.5a1 1 0 001 1h8a1 1 0 001-1v-6.5a1 1 0 00-1-1H2zm.25 1A.25.25 0 002 3v6c0 .138.112.25.25.25h1.5A.25.25 0 004 9V3a.25.25 0 00-.25-.25h-1.5zM5 3a.25.25 0 01.25-.25h1.5A.25.25 0 017 3v6a.25.25 0 01-.25.25h-1.5A.25.25 0 015 9V3zm3.25-.25A.25.25 0 008 3v6c0 .138.112.25.25.25h1.5A.25.25 0 0010 9V3a.25.25 0 00-.25-.25h-1.5z' clip-rule='evenodd'/%3E%3C/svg%3E");}

        .tab.brief::before {content:'';background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%236C757D' d='M22.389 2.22H1.61A.61.61 0 001 2.831v.611a.61.61 0 00.611.611h.611v10.39c0 .674.548 1.221 1.222 1.221h7.64v1.67L8.117 20.3a.611.611 0 000 .864l.432.432a.611.611 0 00.864 0L12 19.01l2.586 2.587a.611.611 0 00.865 0l.431-.433a.611.611 0 000-.864l-2.965-2.966v-1.67h7.639c.674 0 1.222-.547 1.222-1.222V4.053h.61a.611.611 0 00.612-.61V2.83a.611.611 0 00-.611-.611zm-2.445 11.611H4.056V4.053h15.888v9.778z'/%3E%3C/svg%3E");}

        .tab.ce::before {content:'';background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12'%3E%3Cpath fill='%236C757D' fill-rule='evenodd' d='M2 1.75a1 1 0 00-1 1v6.5a1 1 0 001 1h8a1 1 0 001-1v-6.5a1 1 0 00-1-1H2zm.25 1A.25.25 0 002 3v6c0 .138.112.25.25.25h1.5A.25.25 0 004 9V3a.25.25 0 00-.25-.25h-1.5zM5 3a.25.25 0 01.25-.25h1.5A.25.25 0 017 3v6a.25.25 0 01-.25.25h-1.5A.25.25 0 015 9V3zm3.25-.25A.25.25 0 008 3v6c0 .138.112.25.25.25h1.5A.25.25 0 0010 9V3a.25.25 0 00-.25-.25h-1.5z' clip-rule='evenodd'/%3E%3C/svg%3E");}

        .tab.timeline::before {content:'';background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12'%3E%3Cpath fill='%236C757D' fill-rule='evenodd' d='M2 1.75a1 1 0 00-1 1v6.5a1 1 0 001 1h8a1 1 0 001-1v-6.5a1 1 0 00-1-1H2zm.25 1A.25.25 0 002 3v6c0 .138.112.25.25.25h1.5A.25.25 0 004 9V3a.25.25 0 00-.25-.25h-1.5zM5 3a.25.25 0 01.25-.25h1.5A.25.25 0 017 3v6a.25.25 0 01-.25.25h-1.5A.25.25 0 015 9V3zm3.25-.25A.25.25 0 008 3v6c0 .138.112.25.25.25h1.5A.25.25 0 0010 9V3a.25.25 0 00-.25-.25h-1.5z' clip-rule='evenodd'/%3E%3C/svg%3E");}

        .tab.orders::before {content:'';background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12'%3E%3Cpath fill='%236C757D' fill-rule='evenodd' d='M2 1.75a1 1 0 00-1 1v6.5a1 1 0 001 1h8a1 1 0 001-1v-6.5a1 1 0 00-1-1H2zm.25 1A.25.25 0 002 3v6c0 .138.112.25.25.25h1.5A.25.25 0 004 9V3a.25.25 0 00-.25-.25h-1.5zM5 3a.25.25 0 01.25-.25h1.5A.25.25 0 017 3v6a.25.25 0 01-.25.25h-1.5A.25.25 0 015 9V3zm3.25-.25A.25.25 0 008 3v6c0 .138.112.25.25.25h1.5A.25.25 0 0010 9V3a.25.25 0 00-.25-.25h-1.5z' clip-rule='evenodd'/%3E%3C/svg%3E");}

      .menubtn {height:100%;font-size:11px;padding: 0 12px;color:var(--secondary);align-items: center;line-height:32px;cursor:pointer;display:flex;gap:4px;white-space:nowrap;}
        .menubtn:hover, .menubtn.on  {background:var(--border);}
        


    .row {display:flex;gap:4px;}
      .col {display:flex;flex-direction: column;width:100%;}
      .wrap {flex-wrap: wrap;}

    .tags {width:100%;}

    .tag {background:rgb(0 0 0 / 10%);color:rgb(0 0 0 / 65%);font-weight:600;text-transform:uppercase;font-size:11px;padding:0px 4px 1px;border-radius:2px;display:inline-block;}

    #conwrap {position:absolute;top:32px;left:0;right:0;bottom:0;}
      .clopen #conwrap {right: calc(336px + var(--borderwidth));}
      body:not(.clopen) #conwrap {right:0 !important;}
      .popwindow #conwrap {display:none;}

    #subnav {height:var(--subnavheight);position:absolute;top:0;left:0;right:0;background:var(--subnav);border-bottom:var(--borderwidth) solid var(--border);display:flex;align-items:center;padding:0 8px;    justify-content: space-between;}
      .right {display:flex;gap:4px;flex-shrink: 0;}

    input[type=text] {width:100%;height:28px;border:none;background:var(--input);border-bottom:1px solid var(--inputborder);border-radius:0;text-indent: 8px;box-sizing: border-box;}

    input.ctoggle {pointer-events:none;}

    .combobox {display:flex;}
      .combobox input {width:100%;}
      .combobox .btn {border-radius: 0;border-bottom:1px solid var(--inputborder);font-size:9px;background:var(--input);}

    #cl {position:absolute;top:32px;right:0;bottom:0;width:336px;border-left:var(--borderwidth) solid var(--border);background:var(--cl);transform:translateX(100%);z-index:999999;}
    .popwindow #cl {top:0;left:0;width:auto;border:none;transform:translateX(0);}
    .clopen #cl {transform:translateX(0);}
      .filterbar, .editmodebar {position:absolute;top:0;left:0;right:0;height:44px;background:var(--subnav);border-bottom:var(--borderwidth) solid var(--border);display:flex;gap:4px;padding:0 8px;align-items: center;}
        .editmodebar, .editmode .filterbar {display:none;}
        .editmode .editmodebar {display:flex;}
        .filterbar .searchbar {width:100%;}
        .filterbar .btn {}
      .cardlist {position:absolute;top:73px;left:0;right:0;bottom:0;overflow-y:scroll;}
        .popwindow .cardlist {bottom:0;top:calc(var(--subnavheight) + var(--borderwidth));}

      .editmodebar {justify-content: space-between;}
        .editmodebar .left, .editmodebar .right {display:flex;gap:4px;}

    .popoutwindow .filterbar, .popoutwindow .minbtn, .modal .minbtn {display:none;}
      .popoutwindow .cardlist {top:0;}
      


    .btn {height:28px;min-width:28px;border-radius:3px;background:transparent;color:var(--secondary);font-weight:500;display: flex;align-items: center;justify-content: center;padding:0 8px;box-sizing: border-box;font-weight:500;cursor:pointer;user-select:none;font-size:12px;flex-shrink:0;}
      .btn svg {fill:var(--secondary);width:12px;height:12px;}
        .btn:hover, .shadowbtn {background:var(--border);}
        .btn:active {background:var(--hover);}

      .btn.cta {background:var(--cta);color:white;}
        .btn.cta:hover {background:var(--ctahover);}
        .btn.cta:active {background:var(--ctaactive);}

    .btn.on {background:var(--ui7);color:var(--ui1);}
      .btn.on svg {fill:var(--ui1);}

    .btn.outline {border:1px solid var(--border);}

    .btn.floating {position:absolute;top:calc(var(--subnavheight) + var(--borderwidth));left:0;right:0;border-radius:0;background:rgb(12, 90, 206);color:var(--subnav);z-index:9999;}
      .floating.opened {background:var(--subnav);color:rgb(12, 90, 206);border-bottom:var(--borderwidth) solid var(--border);}
      .popwindow .floating {display:none;}

      #tabs .right .btn {min-width:32px;padding:0 8px;height:32px;margin:0;border-radius: 0;}

    .pop {position:relative;}
      .popover {opacity:0;pointer-events: none;position:absolute;top:calc(100% + 4px);left:-40px;background:var(--popover);z-index:999999999999999;padding:4px 0;box-shadow: var(--shadow);border-radius:3px;min-width:160px;user-select:none;}
      .on > .popover {opacity:1;pointer-events: all;}
        .popover h6 {font-size:10px;font-weight:700;color:var(--secondary);text-transform: uppercase;padding:8px 12px 4px;line-height:1;}
        .popitem {padding:0 12px;line-height:28px;color:var(--text);}
          .popitem:hover {background:var(--border);}

            .popitem label {display:flex;gap:8px;align-items: center;}
          .pophover {position:relative;padding-right:32px;white-space: nowrap;}
            .pophover::before {content:'';background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 14'%3E%3Cpath fill='%236C757D' d='M5.284 10.839c-.312-.305-.337-.73 0-1.103L7.907 7 5.284 4.264c-.337-.373-.312-.798 0-1.101.311-.306.838-.286 1.13 0 .293.284 3.152 3.286 3.152 3.286a.766.766 0 010 1.103s-2.86 3.001-3.152 3.287c-.292.285-.819.305-1.13 0z'/%3E%3C/svg%3E");position:absolute;right:8px;top:50%;transform:translateY(-50%);width:14px;height:14px;}

        .popover hr {border:none;height:0.5pt;margin:4px 0;background-color:var(--border)}

          .hoverpop {position:absolute;opacity:0;pointer-events: none;left:100%;top:-4px;}
            .pophover:hover > .hoverpop {opacity:1;pointer-events: all;}

    .card {cursor:grab;user-select:none;padding:6px 16px 6px 24px;position:relative;font-size:12px;display: flex;flex-direction: column;gap:4px;border-bottom:1px solid var(--border);align-items: flex-start;}
      .card::before {content:'';background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 6 10'%3E%3Crect width='2' height='2' fill='%236C757D' rx='1'/%3E%3Crect width='2' height='2' x='4' fill='%236C757D' rx='1'/%3E%3Crect width='2' height='2' x='4' y='4' fill='%236C757D' rx='1'/%3E%3Crect width='2' height='2' y='4' fill='%236C757D' rx='1'/%3E%3Crect width='2' height='2' y='8' fill='%236C757D' rx='1'/%3E%3Crect width='2' height='2' x='4' y='8' fill='%236C757D' rx='1'/%3E%3C/svg%3E");position:absolute;left:8px;top:50%;transform:translateY(-50%);width:6px;height:10px;}
      .card.hide {display:none;}
      .card.used {background:#66519114;}
      .keytag {background:var(--border);color:var(--secondary);font-weight:600;text-transform:uppercase;font-size:11px;padding:0px 4px 1px;border-radius:2px;}
      .mr {line-height:1.2;overflow:hidden;text-overflow: ellipsis;padding-bottom: 2px;overflow-wrap: anywhere;
   display: -webkit-box;
   -webkit-box-orient: vertical;
   -webkit-line-clamp: 2;}

   .dragcard.editing {background:white !important;color:black !important;transform:scale(1.1);z-index:9999999 !important;    transform-origin: top center;}
        .dragcard.editing .keytag {box-shadow: none;}
    .dragcard.editing .mr {-webkit-line-clamp:unset;outline-offset:4px;outline:none;cursor:text;}

    .ignore > * {pointer-events: none;}
        

   .mr, .tr, .br {}

   .card.archived, .dragcard.archived {display:none !important;}

        

        .card .expand {width:100%;display:none;flex-direction: column;gap:16px;align-items: flex-start;padding:8px 0;}
          .popoveredit #cl .card .expand {position:fixed;left:0;top:50%;transform:translate(-102%, -50%);background:var(--ui1);padding:12px 16px;border:1px solid var(--border);max-height:80%;overflow-y:auto;box-shadow: 0 0 0 2px #7a61ff;border-radius:3px;}
        .card.expanded {box-shadow: inset 0 0 0 2px #7a61ff;background:transparent;}
          
        .expanded .expand {display:flex;}
          body:not(.popoveredit) #cl .expanded .tr, body:not(.popoveredit) #cl .expanded .mr, body:not(.popoveredit) #cl .expanded .br, body:not(.popoveredit) #cl .expanded .check,.modal .expanded .tr,.modal .expanded .mr, .modal .expanded .br, .modal .expanded .check {display:none;}
        
          .card.locked {box-shadow:inset 0 0 0 3px var(--secondary);}
            .card.locked .lockbtn {background:var(--secondary);color:var(--ui1);}

        .activities, .comments {position: absolute;top:0;left:0;right:0;bottom:0;z-index:4;display:none;background:var(--cl);}
          .aactive .activities, .cactive .comments {display:block;}

          .etr {display:flex;justify-content: space-between;width: 100%;gap:4px;}
            .etr .right {display:flex;}

          textarea {width:100%;height:120px;overflow:hidden;background:var(--textarea);border:none;border-bottom:1px solid var(--inputborder);border-radius:0;padding:8px;box-sizing:border-box;resize:none;font-size:14px;color:var(--tacolor);font-weight:500;}

            .btnrow {display:flex;gap:2px;}
            .label {font-size:12px;color:var(--secondary);margin-bottom:2px;}

        .card .check {display:none;position:absolute;left:6px;top:50%;transform:translateY(-50%);}
          .editmode .card .check {display:block;}
            .editmode .card::before {content:'';}

        .c4l .mr {-webkit-line-clamp: 4;}
      .br {display:flex;gap:4px 12px;flex-wrap: wrap;}

      .meta {display:flex;font-size:10px;color:var(--secondary);gap:4px;font-weight:600;}
        .meta .icon, .meta svg {width:12px;height:12px;fill:var(--secondary);}
        .meta .data {text-transform:uppercase;}

      .mousegrab  * {cursor:grabbing !important;}

      .dragcard {position:absolute;z-index:9999;background:var(--ui7);width:200px;padding:8px;color:white;cursor:grabbing;user-select:none;border-radius:3px;display: flex;flex-direction: column;align-items: self-start;justify-content: flex-start;}
        .dragcard.focused, .dragcard:focus-within {box-shadow:0 0 0 2px #7B61FF !important;}
        .dragcard .mr {-webkit-line-clamp: 4;width:100%;}
          .slide .dragcard:not(.editing) .mr {-webkit-line-clamp: 8;}

          .dragcard .keytag {box-shadow:inset 0 0 0 12px rgba(0, 0, 0, 0.1);}

    .whitecards .dragcard {background-color:white !important;color:var(--text) !important;box-shadow: rgb(23 43 77 / 10%) 0px 1px 1px, rgb(23 43 77 / 20%) 0px 0px 1px;}
        .whitecards .dragcard .keytag {box-shadow:none;}

    .tagdrop {font-size:9px;display:flex;width:100%;padding:4px 8px 4px 4px;border-radius:0px;background:var(--input);border-bottom:1px solid var(--inputborder);color:var(--secondary);justify-content: space-between;align-items:center;cursor:pointer;}


      #container {position:absolute;top:calc(var(--subnavheight) + var(--borderwidth));left:0;right:0;bottom:0;overflow:auto;}

        .view {display:none;padding:16px;max-width:100%;min-height:100%;box-sizing: border-box;}
          .view.show {display:flex;}

          .dragscroll {cursor: grab;}
            .dragscroll:active {cursor:grabbing}

        /* #container.home #home, #container.p1 #p1,#container.p2 #p2 {display:flex;} */
        .listcontainer {display:flex;flex-direction: row;gap:12px;}
          .list {width:232px;min-height:200px;padding:8px;border-radius:3px;flex-shrink:0;background:#edeff2;box-sizing: border-box;display:flex;flex-direction: column;gap:4px;align-items: flex-start;user-select:none;align-self: flex-start;transition:background-color 25ms linear;position:relative;padding-bottom:32px;}
          .list.hovering {background:#aa99ff71;}
          .list.draggingover {background:#aa99ff71;}
            .list.draggingover > * {pointer-events: none !important;}

            .list::after {content:'Add card';font-size: 12px;position:absolute;bottom:6px;left:8px;cursor: pointer;}
            .list::before {content:'Insert card';font-size: 12px;position:absolute;bottom:6px;right:8px;display:block;z-index:3;cursor: pointer;}

        .listmenu {position:absolute;top:2px;right:2px;}

        input + .listmenu {display:none;}

        .listtag {background:rgb(0 0 0 / 10%);color:rgb(0 0 0 / 65%);font-weight:700;text-transform:uppercase;font-size:11px;padding:0px 4px 1px;border-radius:2px;display:inline-block;flex-grow: 0;position: relative;}

      .listbtn {margin-left:12px;color:var(--middark);}


      .logo {justify-content: center;}
        .logo svg {width:18px;height:18px;}

      .chev {width:12px;height:12px;fill:var(--secondary)}


        .meta {display:none;margin-top:4px;}
        .ctag .metatag, .ceditor .metaeditor, .cedited .metaedited, .cupdated .metaupdated, .ccreator .metacreator, .ccreated .metacreated, .creactions .metareactions, .ccomments .metacomments, .cuses .metauses, .cactor .metaactor, .csource .metasource, .cid .metaid {display:flex;}


        .deck {position:absolute;top:1px;left:0;bottom:0;width:180px;background:white;border-right:1px solid var(--border);}
          .deck .minislide {width:calc(100% - 24px);margin:12px;aspect-ratio: 16/9;border:2px solid var(--border);border-radius:4px;background-size:cover;}
          .slidecanvas {overflow:auto;    position: absolute;    left: 181px;    top: 0;    right: 0;    bottom: 0;}
            .slide {width:calc(100vw - 240px);aspect-ratio: 16/9;max-height:calc(100vh - 120px);background-color: white;position:absolute;top:50%;left:calc(50%);transform:translate(-50%, -50%);border:1px solid var(--border);}
              .clopen .slide {width:calc(100vw - 580px);}

      .cardactivity {color:var(--secondary);}
      .cardactions {display:flex;gap:4px;}

      .starttime {color:var(--secondary);}
        .starttime .row {align-items: center;gap:8px;}
          .starttime .row label {display:flex;align-items: center;gap:4px;}


    .toast {position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#E83F45;color:var(--toasttext);padding:8px 12px ;border-radius: 8px;z-index:9999999999999999;display:flex;gap:12px;align-items: center;font-size:12px; font-weight: 500;}
        .toast .btn {color:var(--toasttext);font-weight:700;text-transform: uppercase;}
          .toast .btn:hover {color:var(--toasttext);background:rgba(255, 255, 255, 0.08);}
          .toast .btn:active {color:var(--toasttext);background:rgba(255, 255, 255, 0.12);}


    .overlay {position: fixed;top:0;left:0;bottom:0;right:0;background:rgba(0, 0, 0, 0.6);z-index: 99999999999;}
      .modal {position:absolute;max-width:800px;width:80%;max-height:80%;overflow-y:auto;left:50%;top:50%;transform:translate(-50%, -50%);background:var(--ui1);z-index:2;    border-radius: 3px;box-shadow: rgb(9 30 66 / 8%) 0px 0px 0px 1px, rgb(9 30 66 / 8%) 0px 2px 1px, rgb(9 30 66 / 31%) 0px 0px 20px -6px;}
        .modal .card {box-shadow:none;padding:12px 16px;}
          .modal .card::before {content:none;}

    .cardactivity {display:flex;justify-content: space-between;width:100%;}

    .dashitem {background:var(--ui1);display:flex;flex-direction: column;border:1px solid var(--border);border-radius:3px;}
        .dashitem h5 {padding:8px 12px 8px;}
        .dashrow {display:flex;gap:12px;padding:8px 12px;border-top:1px solid var(--border);}

        #resizecl {position:absolute;top:0;right:0;width:4px;bottom:0;cursor:col-resize;z-index:999999;}


    .editorbar {display:flex;gap:2px;margin: 0 2px -30px;position:relative;z-index: 2;}
        .editorbar .btn {border-radius: 0;color:var(--ui9);font-weight:700;}

    .link {text-decoration:underline;cursor: pointer;}


    .colorpop {display: grid;grid-template-columns: repeat(9, 1fr);padding:4px;}
      .coloritem {width:24px;height:24px;display:grid;border-radius:0;cursor:pointer;}
        .color28 {background:#FCCFD2;}
        .color29 {background:#FFE1CC;}
        .color30 {background:#FEF3CD;}
        .color31 {background:#9DEEB4;}
        .color32 {background:#86EEED;}
        .color33 {background:#B4E6FD;}
        .color34 {background:#E6D5FF;}
        .color35 {background:#FFCEE1;}
        .color36 {background:#E2E3E9;}
        .color1 {background:#FF767D;}
        .color2 {background:#FFAB70;}
        .color3 {background:#FDDE72;}
        .color4 {background:#3CBB60;}
        .color5 {background:#00BAB5;}
        .color6 {background:#31B0FF;}
        .color7 {background:#BA8EFF;}
        .color8 {background:#FB75A7;}
        .color9 {background:#AEB2C1;}
        .color10 {background:#E0272F;}
        .color11 {background:#FA6800;}
        .color12 {background:#F7C003;}
        .color13 {background:#1A7F39;}
        .color14 {background:#007D79;}
        .color15 {background:#0072C3;}
        .color16 {background:#8A3FFC;}
        .color17 {background:#D12765;}
        .color18 {background:#6D738D;}
        .color19 {background:#A41920;}
        .color20 {background:#B84C00;}
        .color21 {background:#B58D02;}
        .color22 {background:#11652A;}
        .color23 {background:#006263;}
        .color24 {background:#0157A0;}
        .color25 {background:#6E31CA;}
        .color26 {background:#A01951;}
        .color27 {background:#505468;}
        .color37 {background:#851319;}
        .color38 {background:#883900;}
        .color39 {background:#997802;}
        .color40 {background:#0c441d;}
        .color41 {background:#004849;}
        .color42 {background:#003c70;}
        .color43 {background:#53249b;}
        .color44 {background:#7e1340;}
        .color45 {background:#323441;}


    .spacer {width:16px;flex-shrink: 0;}

    #subnav .left {gap:4px;}
      .subnavnav {padding:0 8px;}

    .scratchpad {background:var(--ui1);position:absolute;top:0;left:0;right:0;bottom:0;overflow-y:scroll;}



    .boundingbox {box-shadow: 0 0 0 var(--selectwidth) var(--select);pointer-events:none;
                padding:var(--selectgap);margin:calc(var(--selectgap) * -1) 0 0  calc(var(--selectgap) * -1);}

    .selectwhite .boundingbox {box-shadow: 0 0 0 var(--selectwidth) var(--select), inset 0 0 0 1px white;}
    .selectblack .boundingbox {box-shadow: 0 0 0 var(--selectwidth) var(--select), inset 0 0 0 1px black;}


        .bhandle {border-radius:2px;position:absolute;background:white;box-shadow:inset 0 0 0 2px var(--handlecolor);width:var(--handlesize);height:var(--handlesize);transition:box-shadow 125ms ease-in-out, transform 125ms ease-in-out, opacity 125ms ease-in-out;pointer-events:all;display:none;}
            .bhandle:hover, .bhandle.active {box-shadow:inset 0 0 0 2px var(--handlecolor), inset 0 0 0 12px var(--handlecolor);}

            .bhandle::after {content:'';position:absolute;width:48px;height:48px;top:50%;left:50%;transform:translate(-50%, -50%);}

        .boundingbox .bhandle:nth-child(1) {top:calc(var(--handlegap) - (var(--selectwidth) / 2) );left:calc(var(--handlegap) - (var(--selectwidth) / 2) );cursor:nwse-resize;}
        .boundingbox .bhandle:nth-child(2) {top:calc(var(--handlegap) - (var(--selectwidth) / 2) );right:calc(var(--handlegap) - (var(--selectwidth) / 2) );cursor:nesw-resize;}
        .boundingbox .bhandle:nth-child(3) {bottom:calc(var(--handlegap) - (var(--selectwidth) / 2) );left:calc(var(--handlegap) - (var(--selectwidth) / 2) );cursor:nesw-resize;}
        .boundingbox .bhandle:nth-child(4) {bottom:calc(var(--handlegap) - (var(--selectwidth) / 2) );right:calc(var(--handlegap) - (var(--selectwidth) / 2) );cursor:nwse-resize;}


        .boundingbox .bhandle:nth-child(5) {top:calc(var(--handlegap) - (var(--selectwidth) / 2) );left:50%;cursor:ns-resize;transform:translateX(-50%);}
        .boundingbox .bhandle:nth-child(6) {top:50%;right:calc(var(--handlegap) - (var(--selectwidth) / 2) );cursor:ew-resize;transform:translateY(-50%);}
        .boundingbox .bhandle:nth-child(7) {bottom:calc(var(--handlegap) - (var(--selectwidth) / 2) );left:50%;cursor:ns-resize;transform:translateX(-50%);}
        .boundingbox .bhandle:nth-child(8) {top:50%;left:calc(var(--handlegap) - (var(--selectwidth) / 2) );cursor:ew-resize;transform:translateY(-50%);}

        .boundingbox.minwidth .bhandle:nth-child(5), .boundingbox.minwidth .bhandle:nth-child(7)  {opacity:0;pointer-events:none;transform:translateX(-50%) scale(0);}
        .boundingbox.minheight  .bhandle:nth-child(6), .boundingbox.minheight .bhandle:nth-child(8)  {opacity:0;pointer-events:none;transform:translateY(-50%) scale(0);}
    
            .boundingbox.minwidth .bhandle::after, .boundingbox.minheight .bhandle::after  {width:24px;height:24px;}


      .floatinglib {position:absolute;z-index:999999;background:white;width:240px;border-radius:3px;box-shadow:var(--shadow);}

  </style>
  <script src="../js/base.js"></script>
  <script src="../js/gator.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
</head>

<body class="clopen">
  <div id=wrapper>
    <div id=tabs>
      <div class=left>
        <div class="tab logo" data-view=p0>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18">
            <path fill="#9DCAE7" d="M6.106 10.667L16.449.321H.32V6.11h5.785v4.558z"/>
            <path fill="#49A2DA" d="M7.333 11.894L17.679 1.55v16.127h-5.788v-5.784H7.333z"/>
          </svg>
        </div>
        <div class="menubtn planhome pop" data-view=planhome>Conquer the World
          <svg class=chev viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M5.41921 9.05756C5.94241 8.52236 6.67081 8.48036 7.31041 9.05756L12 13.554L16.6896 9.05756C17.3292 8.48036 18.0588 8.52236 18.5784 9.05756C19.1016 9.59156 19.068 10.494 18.5784 10.9956C18.0912 11.4972 12.9444 16.398 12.9444 16.398C12.684 16.6656 12.342 16.8 12 16.8C11.658 16.8 11.316 16.6656 11.0532 16.398C11.0532 16.398 5.90881 11.4972 5.41921 10.9956C4.92961 10.494 4.89601 9.59156 5.41921 9.05756Z"/>
          </svg>
          <div class=popover style="left:0;">
            <div class="popitem pophover">Plan - Conquer the World
              <div class="hoverpop popover">
                <div class=popitem>Overview</div>
                <div class=popitem>Properties</div>
                <div class=popitem>Share</div>
                <div class=popitem>Duplicate</div>
                <div class=popitem>Delete</div>
              </div>
            </div>
            <hr>
            <div class="popitem pophover">Recently closed
              <div class="hoverpop popover">
                <div class=popitem>Board XYZ</div>
                <div class=popitem>Brief XYZ</div>
                <div class=popitem>Orders XYZ</div>
                <div class=popitem>Timeline XYZ</div>
              </div>
            </div>
            <hr>
            <div class="popitem pophover">Recent updates
              <div class="hoverpop popover">
                <div class=popitem>Board 123</div>
                <div class=popitem>Brief 123</div>
                <div class=popitem>Orders 123</div>
                <div class=popitem>Timeline 123</div>
              </div>
            </div>
            <hr>
            <div class="popitem pophover">Boards

              <div class="hoverpop popover">
                <div class="popitem newboardbtn">Create new board</div>
                <hr>
                <div class=popitem>Phase I</div>
                <div class=popitem>Phase II</div>
                <div class=popitem>Phase III</div>
                <div class=popitem>RFI</div>
              </div>
            </div>
            <div class="popitem pophover">Timeline<div class="hoverpop popover">
              <div class="popitem newtimelinebtn">Create new timeline</div>
              <hr>
              <div class=popitem>Phase I</div>
              <div class=popitem>Phase II</div>
              <div class=popitem>Phase III</div>
              <div class=popitem>RFI</div>
            </div></div>
            <div class="popitem pophover">Cause & effect<div class="hoverpop popover">
              <div class="popitem newcebtn">Create new cause & effect</div>
              <hr>
              <div class=popitem>Phase I</div>
              <div class=popitem>Phase II</div>
              <div class=popitem>Phase III</div>
              <div class=popitem>RFI</div>
            </div></div>
            <div class="popitem pophover">Briefs<div class="hoverpop popover">
              <div class="popitem newbriefbtn">Create new brief</div>
              <hr>
              <div class=popitem>Phase I</div>
              <div class=popitem>Phase II</div>
              <div class=popitem>Phase III</div>
              <div class=popitem>RFI</div>
            </div></div>
            <div class="popitem pophover">Orders<div class="hoverpop popover">
              <div class="popitem newordersbtn">Create new orders</div>
              <hr>
              <div class=popitem>Phase I</div>
              <div class=popitem>Phase II</div>
              <div class=popitem>Phase III</div>
              <div class=popitem>RFI</div>
            </div></div>
            <div class="popitem pophover">1 Axis Scratch<div class="hoverpop popover">
              <div class="popitem newscratchbtn">Create new</div>
              <hr>
              <div class=popitem>Phase I</div>
              <div class=popitem>Phase II</div>
              <div class=popitem>Phase III</div>
              <div class=popitem>RFI</div>
            </div></div>
            <hr>
            <div class="popitem pophover">Plans

              <div class="hoverpop popover">
                <div class="popitem newplanbtn">Create new plan</div>
                <hr>
                <div class="popitem planswapbtn">Plan A</div>
                <div class="popitem planswapbtn">Plan B</div>
                <div class="popitem planswapbtn">Plan C</div>
              </div>
            </div>
            <hr>
            <div class="popitem pophover">Account<div class="hoverpop popover">
              <div class=popitem>Profile</div>
              <div class=popitem>Security</div>
              <hr>
              <div class=popitem>Logout</div>
            </div></div>
            <div class="popitem pophover">Team<div class="hoverpop popover">
              <div class=popitem>Add team member</div>
              <div class=popitem>View team</div>
            </div></div>
            <div class=popitem>Activity</div>
            <hr>
            <div class=popitem>Help</div>
          </div>
        </div>
        <div id=tabwrap>
          <!-- <div class="tab board closeable current" data-view=p1>
            Phase I
            <div class="btn xbtn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M14.87 12.002l4.3-4.3a1.352 1.352 0 000-1.91l-.956-.956a1.352 1.352 0 00-1.912 0l-4.3 4.3-4.3-4.3a1.352 1.352 0 00-1.91 0l-.956.955a1.352 1.352 0 000 1.912l4.3 4.3-4.3 4.3a1.352 1.352 0 000 1.91l.955.956a1.352 1.352 0 001.912 0l4.3-4.3 4.3 4.3a1.352 1.352 0 001.91 0l.956-.955a1.352 1.352 0 000-1.912l-4.3-4.3z"/>
              </svg>
            </div>
          </div> -->
          <div class="tab brief closeable" data-view=p2>Mission Brief<div class="btn xbtn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M14.87 12.002l4.3-4.3a1.352 1.352 0 000-1.91l-.956-.956a1.352 1.352 0 00-1.912 0l-4.3 4.3-4.3-4.3a1.352 1.352 0 00-1.91 0l-.956.955a1.352 1.352 0 000 1.912l4.3 4.3-4.3 4.3a1.352 1.352 0 000 1.91l.955.956a1.352 1.352 0 001.912 0l4.3-4.3 4.3 4.3a1.352 1.352 0 001.91 0l.956-.955a1.352 1.352 0 000-1.912l-4.3-4.3z"/>
            </svg>
          </div></div>
        </div>
      </div>
      <div class="right">
        <div class="btn toggle whitebtn" data-class=whitecards>
          white cards
        </div>
        <div class="btn toggle popoverbtn" data-class=popoveredit>
          popover
        </div>
        <!-- <div class="btn toggle tablebtn" data-class=tableview>
          Table view
        </div> -->
        <div class="btn toggle clbtn on" data-class=clopen>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12">
            <path fill-rule="evenodd" d="M3.162 1.714a.839.839 0 00-.841.837v5.017c0 .462.376.836.84.836h7.57c.464 0 .84-.374.84-.836V2.55a.839.839 0 00-.84-.837H3.16zm.105 1.255a.105.105 0 00-.105.104V3.7c0 .058.047.105.105.105h2.312a.105.105 0 00.106-.105v-.627a.105.105 0 00-.106-.104H3.267zm-.105 1.777c0-.058.047-.105.105-.105h7.358c.058 0 .105.047.105.105v.627a.105.105 0 01-.105.104H3.267a.105.105 0 01-.105-.104v-.627zm.105 1.568a.105.105 0 00-.105.104v.627c0 .058.047.105.105.105h6.517a.105.105 0 00.105-.105v-.627a.105.105 0 00-.105-.104H3.267z" clip-rule="evenodd"/>
            <path d="M1.48 3.596h-.105a.943.943 0 00-.947.94v4.809c0 .52.424.94.947.94h7.358a.943.943 0 00.946-.94V9.24H2.741A1.258 1.258 0 011.48 7.986v-4.39z"/>
          </svg>
        </div>
      </div>
    </div>
    <div id=conwrap>
      <div id=resizecl></div>
      <div id="subnav">
        <div class=left>
          <div class="subnavnav btn pop">File
            <div class=popover style="left:0;">
              <div class=popitem>Download</div>
              <div class=popitem>New</div>
              <div class=popitem>Print</div>
              <div class=popitem>XYZ</div>
            </div>
          </div>
          <div class="subnavnav btn">View</div>
          <div class="subnavnav btn pop">Insert
            <div class=popover style="left:0;">
              <div class="popitem insertboard">Board</div>
              <div class="popitem inserttimeline">Timeline</div>
              <div class="popitem insertce">Cause & effect</div>
              <div class="popitem inserttext">Text</div>
              <div class="popitem inserttable">Table</div>
              <div class="popitem insertlist">List</div>
              <div class="popitem insertimg">Image</div>
            </div>
          </div>
        </div>
        <div class="right">
          <div class="btn pop" data-class=boardprop>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"></path></svg>
            <div class=popover id=tabpop style="left:auto;right:0;">
              <div class=popitem>Rename</div>
              <div class=popitem>Copy</div>
              <div class=popitem>Delete</div>
              <hr>
              <div class=popitem>Share</div>
            </div>
          </div>
        </div>
      </div>

      <div id=container class=dragscroll>

        <div id=p0 class=view style="flex-direction: column;">

          <div class=dashitem>
            <h5>Plan B</h5>
            <div class=dashrow>
              <div>Board 2</div><div>2 mins ago</div>
            </div>
            <div class=dashrow>
              <div>Board 3</div><div>1 hr ago</div>
            </div>
            <div class=dashrow>
              <div>Board 1</div><div>2 days ago</div>
            </div>
          </div>

          <div class=dashitem>
            <h5>Plan A</h5>
            <div class=dashrow>
              <div>Board 2</div><div>52 mins ago</div>
            </div>
            <div class=dashrow>
              <div>Board 3</div><div>1 hr ago</div>
            </div>
            <div class=dashrow>
              <div>Board 1</div><div>2 days ago</div>
            </div>
          </div>
        </div>

        <div id=p2 class=view>
          <div class=deck>
            <div class=minislide></div>
          </div>
          <div class=slidecanvas>
            <div class=slide>

            </div>
          </div>
        </div>

        <div id=p1 class="view show">
          <div class=listcontainer>
            <div class=list>
              <div class=listtag>Uncategorized</div>
            </div>
          </div>
          <div class="btn listbtn addlist shadowbtn">Add list</div>
        </div>

        <div id=p3 class=view>
          <div class=timeline>
            <div class=timelength>
              length
            </div>
            <div class=timecanvas>
              canvas
            </div>
          </div>
        </div>


      </div>
    </div>

    <div id=cl class="">
      <div class="btn floating" id=openpopwindow onclick="openpop();this.classList.add('opened');localStorage.opennew = true">Open in new window</div>
      <div class=editmodebar>
        <div class=left>
          <input type=checkbox class=selectall style="margin-left:-2px" />
        </div>
        <div class=right>
          <div class="btn">
            Copy
          </div>
          <div class="btn">
            Merge
          </div>
          <div class="btn deletecards">
            Delete
          </div>
          <div class="btn cta" onclick="document.getElementById('cl').classList.remove('editmode')">
            Done
          </div>
        </div>
      </div>
      <div class=filterbar>
        <input class=searchbar placeholder="Filter cards..." type=text />
        <div class="btn pop" id=sort>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12">
            <path d="M5.781 8.063H4.75V1.53a.344.344 0 00-.344-.343H3.72a.344.344 0 00-.344.343v6.532H2.344a.344.344 0 00-.243.586l1.719 2.063a.343.343 0 00.486 0l1.719-2.063a.344.344 0 00-.244-.586zM10.15 3.35L8.43 1.288a.344.344 0 00-.486 0L6.225 3.351a.344.344 0 00.244.587h1.03v6.53a.344.344 0 00.345.345h.687a.344.344 0 00.344-.344V3.938h1.031c.305 0 .46-.37.243-.587z" />
          </svg>

          <div class=popover>
            <h6>Sort</h6>
            <div class=popitem>Description</div>
            <div class=popitem>Key tag</div>
            <div class=popitem>Date created</div>
            <div class=popitem>Date modified</div>
            <div class="popitem pophover">
              More
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class=popitem>Reaction</div>
                <div class=popitem>Edits</div>
                <div class=popitem>Uses</div>
              </div>
            </div>
            <hr>
            <div class=popitem>Ascending</div>
            <div class=popitem>Descending</div>
          </div>
        </div>
        <div class="btn pop">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12">
            <path d="M10.984.5H1.016a.516.516 0 00-.364.88l3.973 3.974v4.427c0 .168.082.326.22.423l1.719 1.202a.516.516 0 00.811-.422v-5.63l3.973-3.974a.516.516 0 00-.364-.88z"/>
          </svg>

          <div class=popover style="left:-72px;">
            <h6>Filter</h6>
            <div class="popitem pophover">
              Tag
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class=popitem>Logisitics</div>
                <div class=popitem>Fact</div>
                <div class=popitem>RFI</div>
                <div class=popitem>Operation</div>
                <div class=popitem>Combat</div>
                <div class=popitem>Enemy</div>
                <div class=popitem>Danger</div>
                <div class=popitem>Neutral</div>
              </div>
            </div>
            <div class="popitem pophover">
              Author
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class=popitem>Dave Brown</div>
                <div class=popitem>Mike Jones</div>
                <div class=popitem>Lindsay Weir</div>
                <div class=popitem>Ashley Smith</div>
                <div class=popitem>Ted Turner</div>
                <div class=popitem>Fred Baker</div>
              </div>
            </div>
            <div class="popitem pophover">
              Editor
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class=popitem>Dave Brown</div>
                <div class=popitem>Mike Jones</div>
                <div class=popitem>Lindsay Weir</div>
                <div class=popitem>Ashley Smith</div>
                <div class=popitem>Ted Turner</div>
                <div class=popitem>Fred Baker</div>
              </div>
            </div>
            <div class="popitem pophover">
              Reaction
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class=popitem>Approved</div>
                <div class=popitem>Important</div>
                <div class=popitem>Unclear</div>
                <div class=popitem>Challenged</div>
              </div>
            </div>
            <div class="popitem pophover">
              Used in
              <div class="hoverpop popover" style="left:-156px;top:-4px;">
                <div class="popitem pophover">
                  Board
                  <div class="hoverpop popover" style="left:-156px;top:-4px;">
                    <div class=popitem>Board 1</div>
                    <div class=popitem>Board 2</div>
                    <div class=popitem>Board 3</div>
                    <div class=popitem>Board 4</div>
                  </div>
                </div>
                <div class="popitem pophover">
                  Cause and effect
                  <div class="hoverpop popover" style="left:-156px;top:-4px;">
                    <div class=popitem>CE 1</div>
                    <div class=popitem>CE 2</div>
                    <div class=popitem>CE 3</div>
                    <div class=popitem>CE 4</div>
                  </div>
                </div>
                <div class="popitem pophover">Timeline
                  <div class="hoverpop popover" style="left:-156px;top:-4px;">
                    <div class=popitem>T 1</div>
                    <div class=popitem>T 2</div>
                    <div class=popitem>T 3</div>
                    <div class=popitem>T 4</div>
                  </div>
                </div>
                <div class="popitem pophover">Brief
                  <div class="hoverpop popover" style="left:-156px;top:-4px;">
                    <div class=popitem>B 1</div>
                    <div class=popitem>B 2</div>
                    <div class=popitem>B 3</div>
                    <div class=popitem>B 4</div>
                  </div>
                </div>
                <div class="popitem pophover">Orders
                  <div class="hoverpop popover" style="left:-156px;top:-4px;">
                    <div class=popitem>O 1</div>
                    <div class=popitem>O 2</div>
                    <div class=popitem>O 3</div>
                    <div class=popitem>O 4</div>
                  </div>
                </div>
              </div>
            </div>
            <hr>
            <div class=popitem>Clear filters</div>
          </div>
        </div>
        <div class="btn pop">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12">
            <path d="M11.36 7.382l-.987-.57c.1-.538.1-1.09 0-1.628l.987-.57a.28.28 0 00.127-.325 5.775 5.775 0 00-1.267-2.193.279.279 0 00-.343-.054l-.987.57A4.371 4.371 0 007.48 1.8V.66c0-.13-.09-.243-.217-.27a5.82 5.82 0 00-2.53 0 .278.278 0 00-.218.27v1.141a4.51 4.51 0 00-1.408.814l-.985-.57a.275.275 0 00-.343.053A5.74 5.74 0 00.513 4.29c-.04.125.014.26.127.325l.987.57c-.1.538-.1 1.09 0 1.628l-.987.57a.28.28 0 00-.127.325A5.776 5.776 0 001.78 9.902a.279.279 0 00.343.053l.987-.57c.415.357.892.633 1.408.814v1.14c0 .13.09.244.218.272.85.19 1.721.18 2.53 0a.278.278 0 00.218-.271v-1.141a4.51 4.51 0 001.408-.814l.987.57a.275.275 0 00.343-.053 5.74 5.74 0 001.267-2.193.286.286 0 00-.13-.327zm-5.361.47a1.857 1.857 0 01-1.854-1.854c0-1.023.832-1.855 1.854-1.855 1.021 0 1.853.832 1.853 1.855A1.857 1.857 0 016 7.853z"/>
          </svg>

          <div class=popover style="left:-104px">
            <h6>Customize</h6>
            <div class=popitem>
              <label>
                <input type=radio class=cradio id=c2l value=c2l name="lines" /> 2 lines
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=radio class=cradio id=c4l value=c4l name=lines /> 4 lines
              </label>
            </div>
            <hr>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=ctag value=ctag /> Tag count
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=ceditor value=ceditor /> Last editor
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=cupdated value=cupdated /> Last Updated
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=ccreator value=ccreator /> Creator
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=ccreated value=ccreated  /> Created
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=creactions value=creactions /> Reactions
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=ccomments value=ccomments /> Comments
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=cuses value=cuses /> Uses
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox  class=ctoggle id=cactor value=cactor /> Actor
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=csource value=csource /> Source
              </label>
            </div>
            <div class=popitem>
              <label>
                <input type=checkbox class=ctoggle id=cid value=cid /> ID
              </label>
            </div>
          </div>
        </div>
        <div class="btn" onclick="document.getElementById('cl').classList.add('editmode')">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M1 3a2 2 0 012-2h18a2 2 0 012 2v18a2 2 0 01-2 2H3a2 2 0 01-2-2V3zm8.969 14.35L5.5 12.883a.688.688 0 010-.972l.972-.973a.687.687 0 01.973 0l3.01 3.01 6.1-6.1a.688.688 0 01.973 0l.972.973a.687.687 0 010 .972l-7.559 7.559a.687.687 0 01-.972 0z" clip-rule="evenodd"/>
          </svg>
        </div>
      </div>
      <div class=cardlist>

      </div>
    </div>
  </div>

  <div id=templates style="display:none;">

    <div id=reactions class="reactions">
      <div class=label>Reactions</div>
      <div class=btnrow>
        <div class="btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 16">
          <path fill="#288F63" fill-rule="evenodd" d="M1.606 8a6.67 6.67 0 016.667-6.667A6.67 6.67 0 0114.94 8a6.67 6.67 0 01-6.667 6.667A6.67 6.67 0 011.606 8zm2.334.588l2.979 2.98c.179.178.47.178.648 0l5.04-5.04a.458.458 0 000-.648l-.649-.648a.458.458 0 00-.648 0L7.243 9.299 5.236 7.292a.458.458 0 00-.648 0l-.648.648a.458.458 0 000 .648z" clip-rule="evenodd"/>
        </svg></div>
        <div class="btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 16">
          <path fill="#1885d8" d="M8.19 1.333a.6.6 0 00-.552.37L6.004 5.596l-4.181.358a.601.601 0 00-.52.417.61.61 0 00.178.645l3.175 2.778-.954 4.129a.61.61 0 00.232.628.595.595 0 00.663.028l3.593-2.19 3.594 2.19a.595.595 0 00.662-.028.61.61 0 00.232-.628l-.954-4.129L14.9 7.016a.61.61 0 00.177-.645.601.601 0 00-.52-.417l-4.18-.358-1.634-3.893a.6.6 0 00-.553-.37z"/>
        </svg></div>
        <div class="btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 16">
          <path fill="#F36D07" fill-rule="evenodd" d="M13.458 1.333H3.088c-.822 0-1.482.6-1.482 1.334V12c0 .733.66 1.333 1.482 1.333H6.05l2.11 1.9c.064.057.16.057.224 0l2.11-1.9h2.963c.815 0 1.482-.6 1.482-1.333V2.667c0-.734-.667-1.334-1.482-1.334zM5.606 5.767H7.11c.034-.627.456-1.032 1.094-1.032.632 0 1.054.383 1.054.91s-.216.8-.932 1.227c-.766.45-1.071.949-1 1.82l.012.322h1.47V8.72c0-.544.206-.816.944-1.243.783-.461 1.188-1.044 1.188-1.882 0-1.265-1.05-2.148-2.636-2.148-1.704 0-2.67.955-2.698 2.32zm2.487 5.9c.505 0 .91-.383.91-.872 0-.488-.405-.871-.91-.871-.5 0-.905.383-.905.871 0 .489.405.872.905.872z" clip-rule="evenodd"/>
        </svg></div>
        <div class="btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 16">
          <path fill="#E83F45" d="M3.273 2c0-.184.15-.333.334-.333h5.666l.667 1h3c.184 0 .333.149.333.333v6c0 .184-.149.333-.333.333H8.773l-.833-1H5.273V14c0 .184-.149.333-.333.333H3.607A.333.333 0 013.273 14V2z"/>
        </svg></div>
      </div>
    </div>

    <div id=tags class="tags">
      <div class=label>Tags</div>
      <div class="row wrap taginput" style="margin-top:4px;">
        <div class=tag>Enemy</div>
        <div class=tag>Operations</div>
        <div class=tag style="background-color: rgb(102, 81, 145); color: white;">CCIR</div>
        <div class=tag>Complex</div>
        <div class=tag>Comms</div>
        <div class=tag style="background-color: rgb(204, 86, 82); color: white;">China</div>
        <div class=tag style="background-color: rgb(53, 55, 158); color: white;">Nato</div>
      </div>
    </div>

    <div id=uses class="uses">
      <div class=label>Used in</div>
      <div class="row wrap">
        <div class=link>Phase I</div>
        <div class=link>Phase II</div>
        <div class=link>Phase III</div>
        <div class=link>Warno</div>
        <div class=link>Brief I</div>
      </div>
    </div>

    <div id=actorsource class="actorsource">
      <div class=row>
        <div class=col>
          <div class=label>Actor</div>
          <input type=text />
        </div>
        <div class=col>
          <div class=label>Source</div>
          <input type=text />
        </div>
      </div>
    </div>

    <div id=customfield class="customfield">
      <div class=row>
        <div class="btn cfbtn outline">Add a custom field</div>
        </div>
    </div>

    <div id=starttime class="starttime">
      <div class=label>Start time</div>
      <div class=row>
        <label><input type=radio name=st checked /> Auto</label>
        <label><input type=radio name=st /> Relative</label>
        <label><input type=radio name=st /> Absolute</label>
      </div>
    </div>

    <div id=duration class="duration" style="width:100%;">
      <div class=label>Duration</div>
      <input type=text style="width:100%;" />
    </div>

    <div id=cardactivity class=cardactivity>
      <div class=left>Updated&nbsp;<u>5 minutes ago</u></div>
      <div class=right>Created <u>11/01/21</u></div>
    </div>

    <div id=cardactions class=cardactions>
      <div class="btn commentbtn outline">0 Comments</div>
      <div class="btn lockbtn outline">Lock</div>
      <div class="btn activitybtn outline">Activity</div>
    </div>

    <div id=cardmenu class="cardmenu popover" style="min-width:80px;left:-52px;">
      <div class=popitem>Copy</div>
      <div class="popitem popout">Popout</div>
      <div class="popitem deletecard">Delete</div>
    </div>

    <div id=comments class=comments>
      <div class="btn closebtn" data-class="cactive">Close Comments</div>
      comments
    </div>

    <div id=activities class=activities>
      <div class="btn closebtn" data-class="aactive">Close Activity</div>
      Card history
    </div>

    <div id=cardtitle class=cardtitle style="width:100%;">
      <div class=label>Title (Optional)</div>
      <input class="etitle" type="text" />
    </div>

    <div id=etext class=etext style="width:100%;">
      <div class=label style="margin-bottom:4px;">Description</div>
      <div class=editorbar>
        <div class=btn>H</div><div class=btn>B</div>
      </div>
      <textarea class="ta" style="padding-top:36px;"></textarea>
    </div>

    <div id=colorpop class="popover colorpop">
      <div class="coloritem color28"></div>
      <div class="coloritem color29"></div>
      <div class="coloritem color30"></div>
      <div class="coloritem color31"></div>
      <div class="coloritem color32"></div>
      <div class="coloritem color33"></div>
      <div class="coloritem color34"></div>
      <div class="coloritem color35"></div>
      <div class="coloritem color36"></div>
      <div class="coloritem color1"></div>
      <div class="coloritem color2"></div>
      <div class="coloritem color3"></div>
      <div class="coloritem color4"></div>
      <div class="coloritem color5"></div>
      <div class="coloritem color6"></div>
      <div class="coloritem color7"></div>
      <div class="coloritem color8"></div>
      <div class="coloritem color9"></div>
      <div class="coloritem color10"></div>
      <div class="coloritem color11"></div>
      <div class="coloritem color12"></div>
      <div class="coloritem color13"></div>
      <div class="coloritem color14"></div>
      <div class="coloritem color15"></div>
      <div class="coloritem color16"></div>
      <div class="coloritem color17"></div>
      <div class="coloritem color18"></div>
      <div class="coloritem color19"></div>
      <div class="coloritem color20"></div>
      <div class="coloritem color21"></div>
      <div class="coloritem color22"></div>
      <div class="coloritem color23"></div>
      <div class="coloritem color24"></div>
      <div class="coloritem color25"></div>
      <div class="coloritem color26"></div>
      <div class="coloritem color27"></div>
      <div class="coloritem color37"></div>
      <div class="coloritem color38"></div>
      <div class="coloritem color39"></div>
      <div class="coloritem color40"></div>
      <div class="coloritem color41"></div>
      <div class="coloritem color42"></div>
      <div class="coloritem color43"></div>
      <div class="coloritem color44"></div>
      <div class="coloritem color45"></div>
    </div>

  </div>
  <script>
    function carddrag(e){
      if ( e.which == 3 || this.draggable ){
        return;
      }
      let sp = this.getparent('scratchpad');
      let t = this;
      let dragcard = false;
      let dragged = false;
      let moved = false;

      let sx = e.clientX;
      let sy = e.clientY;

      let ol = 0;
      let ot = 0;

      if ( !e.target.classList.contains('card') && !e.target.classList.contains('expand') && !e.target.classList.contains('dragcard') && !e.target.classList.contains('ignore')){
        return;
      }

      let text = this.getElementsByClassName('mr')[0].cloneNode(true);
      let keytag = this.getElementsByClassName('keytag')[0];

      // let bg = window.getComputedStyle(keytag).backgroundColor;

      if (!this.classList.contains('focused')){
        document.getElementsByClassName('focused').removeclass('focused');
      }

      let used = t.classList.contains('used') ? true : false;

      let inserted2 = false;

      document.body.classList.add('mousegrab');
      console.log(keytag.innerText.toLowerCase());
      let foundIndex = KEYTAGS.findIndex(x => x.text == keytag.innerText.toLowerCase());
      let KT = KEYTAGS[foundIndex] || {color: 'rgb(221, 221, 221)', tcolor: 'black',  text: keytag.innerText.toLowerCase()};
      let bg = KT.color;
      let kc = KT.tcolor;

      let cc = this;

      if ( !this.classList.contains('dragcard')){
        dragcard = document.createElement('div');
        dragcard.className = 'dragcard';
        dragcard.style.backgroundColor = bg;
        dragcard.style.color = kc;
        let kt = keytag.cloneNode(true);
        // kt.style.backgroundColor = 'rgba(0,0,0,0.1)';
        dragcard.style.opacity = 0;
        dragcard.style.zIndex = 999999999999;
        dragcard.dataset.id = this.dataset.id;
        // dragcard.style.pointerEvents = 'none';
        dragcard.appendChild(kt);
        dragcard.appendChild(text);
        document.body.appendChild(dragcard);

        cc = dragcard.cloneNode(true);
        cc.style.position = 'static';
        cc.style.pointerEvents = 'all';
        cc.style.cursor = 'grab';
        cc.style.zIndex = 9999;
      } else {
        let c = this.cloneNode(true);
        document.body.appendChild(c);
        dragcard = c;
        bg = window.getComputedStyle(c.getElementsByClassName('keytag')[0]).backgroundColor;
        // dragcard.style.pointerEvents = 'none';
        ol = this.offset().x - sx;
        ot = this.offset().y - sy;

        dragcard.style.opacity = 0;
      }


      let x = e.clientX + ol;
      let y = e.clientY + ot;

      dragcard.style.pointerEvents = 'none';
      dragcard.style.position = 'absolute';
      dragcard.style.cursor = 'grabbing';

      dragcard.style.left = x +'px';
      dragcard.style.top = y +'px';

      let lx = e.clientX;
      let ly = e.clientY;

      function move(e){
        // if ( t.classList.contains('expanded')){
        //   return;
        // }
        let x = e.clientX;
        let y = e.clientY;
        let nx = Math.abs(sx - x);
        let ny = Math.abs(sy - y);

        if ( !dragged && Math.max(nx, ny) > 5 ){
          if ( t.classList.contains('dragcard')){
            t.style.opacity = 0;
          }
          dragcard.style.opacity = 1;
          dragged = true;
          // t.classList.add('used');
        } else if (!dragged ){
          return;
        }

        if (!moved && Math.max(nx, ny) > 5 ){
          moved = true;
        }

        dragcard.style.left = x + ol +'px';
        dragcard.style.top = y + ot +'px';

        if ( t.classList.contains('selected')){
          if ( sp ){
            let xxx = sp.getElementsByClassName('dragcard selected');

            for(var i=0;i<xxx.length;i++){
              let xxxx = xxx[i];

              xxxx.style.left = xxxx.offsetLeft +(x- lx)  +'px';
              xxxx.style.top = xxxx.offsetTop + (y-ly) +'px';
            }
          }

          let bb = document.getElementsByClassName('boundingbox');

          if ( bb.length ){
            bb[0].style.left = bb[0].offsetLeft +(x- lx)  +'px';
            bb[0].style.top = bb[0].offsetTop + (y-ly) +'px';
          }
        }

        lx = x;
        ly = y;

        let tars = document.elementsFromPoint(e.clientX, e.clientY);

        let hoverlist = false;
        tars.forEach(tar => {
          if ( tar.classList.contains('list')){
            hoverlist = true;
            if ( !tar.classList.contains('hovering')){
              let hovering = document.getElementsByClassName('list hovering');

              while(hovering[0]){
                hovering[0].removeAttribute('style');
                hovering[0].classList.remove('hovering');
              }
              tar.classList.add('hovering');

              if ( bg.indexOf('rgb') >= 0 ){
                let rgb = bg.replace('rgb(', '').replace(')', '').split(',');

                if ( Number(rgb[0]) < 200 || Number(rgb[1]) < 200 || Number(rgb[2]) < 200) {
                  tar.style.backgroundColor = 'rgba(' + rgb[0] + ',' + rgb[1] + ',' + rgb[2] + ', 0.3)';
                }
              } else if (bg.indexOf('#') >= 0 ){
                let rgb = hex2rgb(bg);
                if ( Number(rgb[0]) < 200 || Number(rgb[1]) < 200 || Number(rgb[2]) < 200) {
                  tar.style.backgroundColor = 'rgba(' + rgb[0] + ',' + rgb[1] + ',' + rgb[2] + ', 0.3)';
                }
              }
            }
            let lists = tar.getElementsByClassName('dragcard');
            let inserted = false;

            for(var i=0;i<lists.length;i++){
              let l = lists[i];
              let lof = l.getBoundingClientRect().y;

              if (  y + ot  < lof ){
                inserted = true;
                  l.parentElement.insertBefore(cc,l);
                  break;
              }
            }

            if (!inserted){
              tar.appendChild(cc);
            }
          }
        });

        if ( !hoverlist ){
          let hovering = document.getElementsByClassName('list hovering');
          while(hovering[0]){
            hovering[0].removeAttribute('style');
            hovering[0].classList.remove('hovering');
          }

          if ( cc.parentNode ){
            cc.parentNode.removeChild(cc);
          }
        }
      }

      function end(e){
        document.removeEventListener('mousemove', move);
        document.removeEventListener('mouseup', end);

        document.body.classList.remove('mousegrab');

        let tars = document.elementsFromPoint(e.clientX, e.clientY);

        tars.forEach(tar => {
          let slide = tar.classList.contains('slide');
          let scratch = tar.classList.contains('scratchpad');
          let list = tar.classList.contains('list');
          if ( list || slide || scratch){
            if (tar == t.getparent('list')){
              return;
            }

            cc.classList.add('focused');
            cc.style.opacity = 1;

            if ( slide || scratch && !e.target.getparent('listcontainer') ){
              cc.style.position = 'absolute';
              cc.style.top = e.clientY + ot + tar.scrollTop - tar.getBoundingClientRect().y - (slide ? 1 : 0) + 'px';
              cc.style.left = e.clientX + ol + tar.scrollLeft - tar.getBoundingClientRect().x - (slide ? 1 : 0) + 'px';
              tar.appendChild(cc);
            } 

            used = true;
            inserted2 = true;

            if ( slide ){
              domtoimage.toPng(tar, {style: {transform: 'none', top:'0', left: '0', border: 'none', position: 'static', overflow: 'hidden'}}).then(function (dataUrl) {
                tar.removeAttribute('style');
                document.getElementsByClassName('minislide')[0].style.backgroundImage = `url(${dataUrl})`;
              }).catch(function (error) {
                  console.error('oops, something went wrong!', error);
              });
            }
            return;
          }
        });

        dragcard.remove();
        let hovering = document.getElementsByClassName('list hovering');

        while(hovering[0]){
          hovering[0].removeAttribute('style');
          hovering[0].classList.remove('hovering');
        }

        if ( !used ){
          t.classList.remove('used');
          t.style.opacity = 1;
          // t.style.display = 'flex';
        } else if ( t.classList.contains('dragcard')){
          //t.remove();
        }

        if ( !inserted2 && !t.classList.contains('dragcard') ){
          cc.remove();
        }

        if ( !moved ){
          if(t.classList.contains('dragcard')){
            t.classList.add('focused');

            let tt = e.target;
            if (tt.classList.contains('mr')){
              let slide = document.getElementsByClassName('view show')[0].getElementsByClassName('slide')[0];
              if ( slide ){
                console.log('slide')
                tt = slide.getElementsByClassName('dragcard focused')[0].getElementsByClassName('mr')[0];
              }

              tt.contentEditable = true;
              tt.focus();
              tt.getparent('dragcard').classList.add('editing');
              tt.classList.remove('ignore');
              tt.onblur = function(){
                tt.getparent('dragcard').classList.remove('editing');
                tt.contentEditable = false;
                tt.classList.add('ignore');
              }
            }

            console.log(t, t.dataset.id)
            let ccc = document.getElementById(t.dataset.id);
            
            if ( ccc && !ccc.classList.contains('expanded') ){
              document.getElementsByClassName('expanded').removeclass('expanded');
              ccc.classList.add('expanded');
              
              let txa = ccc.getElementsByTagName('textarea')[0];
              ta.call(txa);

              if ( document.getElementsByClassName('clbtn')[0].classList.contains('on') ){
                ccc.scrollIntoViewIfNeeded(false);
                //txa.focus();
              }
            }              
            
            if ( window.clwindow ){
              let id = t.dataset.id;
              let clw = window.clwindow;
              clw.focus();
              let cccc = clw.document.getElementById(id);
              clw.document.getElementsByClassName('expanded').removeclass('expanded');
              cccc.classList.add('expanded');
              let txa = cccc.getElementsByTagName('textarea')[0];
              ta.call(txa);
              txa.focus();
              cccc.scrollIntoViewIfNeeded(false);
            }
          } else if ( !e.target.classList.contains('check') && !t.classList.contains('expanded') ) {

            if(document.getElementById('cl').classList.contains('editmode')){
              t.getElementsByClassName('check')[0].click();
              return;
            }

            document.getElementsByClassName('expanded').removeclass('expanded');
            t.classList.add('expanded');
            t.scrollIntoViewIfNeeded(false);
            let txa = t.getElementsByTagName('textarea')[0];
            ta.call(txa);
            txa.focus();
            
          }
        }
      }

      document.addEventListener('mousemove', move);
      document.addEventListener('mouseup', end);
    }

    function makekeytags(){
      window.KEYTAGS = [{color: '#003f5c', text: 'logisitics'}, {color: '#2f4b7c', text: 'fact'}, {color: '#665191', text: 'rfi'}, {color: '#a05195', text: 'operation'}, {color: '#d45087', text: 'combat'}, {color: '#f95d6a', text: 'enemy'}, {color: '#ff7c43', text: 'danger'}, {color: '#ffa600', text: 'neutral'}, {color: '#ddd', text: 'uncategorized'} ];

      for(var i=0;i<KEYTAGS.length;i++){
        let t = KEYTAGS[i];
        let w = contrastr(t.color, '#fff');
        let b = contrastr(t.color, '#000');
        console.log(w,b)
        KEYTAGS[i].tcolor = w > b ? '#fff' : '#000';
      }
    }

    function makektpop(e){
      let ktpop = document.createElement('div');
      ktpop.className ='popover ktpop';
      ktpop.style.left = '0';

      for(let i=0;i<KEYTAGS.length;i++){
        let t = KEYTAGS[i];
        let pi = document.createElement('div');
        let kt = document.createElement('div');

        if ( !KEYTAGS[i].tcolor ){
          let w = contrastr(t.color, '#fff');
          let b = contrastr(t.color, '#000');
          console.log(w,b)
          KEYTAGS[i].tcolor = w > b ? '#fff' : '#000';
        }
        
        pi.className = 'popitem ktitem';
        pi.style.lineHeight = 'unset';
        pi.style.height = '28px';
        pi.style.display = 'flex';
        pi.style.alignItems = 'center';
        pi.style.justifyContent = 'start';
        kt.className = 'keytag ignore';
        kt.dataset.tag = t.text;
        kt.style.backgroundColor = t.color;
        kt.style.color = t.tcolor;
        kt.dataset.text = t.text.toLowerCase();
        kt.dataset.color = t.color;

        kt.appendChild(document.createTextNode(t.text));

        pi.appendChild(kt);

        ktpop.appendChild(pi);
      }

      return ktpop;
    }

    function makecards(c, single = false, keytag = false){
      let cl = document.getElementById('cl').getElementsByClassName('cardlist')[0];

      let cid = false;

      for(let i=0;i<c;i++){
        let card = document.createElement('div');
        let tr = document.createElement('div');
        let mr = document.createElement('div');
        let check = document.createElement('input');

        let expand = document.createElement('div');
        let etag = document.createElement('div');
        let ecombo = document.createElement('div');
        let etitle = document.createElement('input');
        let euses = document.getElementById('uses').cloneNode(true);
        let ereact = document.getElementById('reactions').cloneNode(true);
        let etags = document.getElementById('tags').cloneNode(true);
        let eas = document.getElementById('actorsource').cloneNode(true);
        let cfb = document.getElementById('customfield').cloneNode(true);
        let est = document.getElementById('starttime').cloneNode(true);
        let ed = document.getElementById('duration').cloneNode(true);
        let ecs = document.getElementById('cardactivity').cloneNode(true);
        let eca = document.getElementById('cardactions').cloneNode(true);
        let ect = document.getElementById('cardtitle').cloneNode(true);
        let etext = document.getElementById('etext').cloneNode(true);

        let menupop = document.getElementById('cardmenu').cloneNode(true);
        let com = document.getElementById('comments').cloneNode(true);
        let act = document.getElementById('activities').cloneNode(true);

        // let ktp = ktpop.cloneNode(true);

        let minb = document.createElement('div');
        let men = document.createElement('div');
        let rt = document.createElement('div');
        let etr = document.createElement('div');

        ereact.removeAttribute('id');
        euses.removeAttribute('id');
        etags.removeAttribute('id');
        eas.removeAttribute('id');
        est.removeAttribute('id');
        ed.removeAttribute('id');
        ecs.removeAttribute('id');
        eca.removeAttribute('id');
        menupop.removeAttribute('id');
        com.removeAttribute('id');
        act.removeAttribute('id');
        cfb.removeAttribute('id');
        ect.removeAttribute('id');

        let rad = est.querySelectorAll('input[name=st]');
        let nn = 'st-' + Date.now() + Math.floor(Math.random() * 1000);
        for(var ii=0;ii<rad.length;ii++){
          rad[ii].name = nn;
        }

        // etext.className = 'etext';

        card.className = 'card';
        let id = 'c-' + document.getElementsByClassName('card').length;
        card.dataset.id = id;
        card.id = id;

        cid = id;

        tr.className = 'tr ignore';
        mr.className = 'mr ignore';

        expand.className = 'expand';

        let kt = document.createElement('div');
        kt.className = 'keytag ignore';
        let tag = !keytag ? KEYTAGS.random() : keytag;
        kt.dataset.tag = tag.text;
        kt.style.backgroundColor = tag.color;
        kt.style.color = tag.tcolor;

        check.type = 'checkbox';
        check.className = 'check';

        rt.className = 'right';
        men.className = 'btn menbtn pop';
        minb.className = 'btn minbtn';
        etr.className = 'etr';
        etag.className = 'tagdrop pop';

        minb.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 352H48c-26.5 0-48 21.5-48 48v32c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-32c0-26.5-21.5-48-48-48z"></path></svg>`;
        men.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"></path></svg>`;

        minb.title = 'Minimize';

        men.appendChild(menupop);

        let content = !single ? generate() : 'none';

        kt.appendChild(document.createTextNode(tag.text));

        etag.appendChild(kt.cloneNode(true));

        rt.appendChild(minb);
        rt.appendChild(men);

        tr.appendChild(kt);

        mr.appendChild(document.createTextNode(content));

        etext.getElementsByTagName('textarea')[0].value = content;

        let meta = makemeta(i);

        card.appendChild(tr);
        card.appendChild(mr);
        card.appendChild(meta);
        card.appendChild(check);

        etag.appendChild(document.createTextNode('▼'));
        // etag.appendChild(ktp);

        etr.appendChild(etag);
        etr.appendChild(rt);

        expand.appendChild(etr);
        expand.appendChild(etext);
        expand.appendChild(ect);
        expand.appendChild(etags);
        expand.appendChild(euses);
        // expand.appendChild(eas);
        expand.appendChild(est);
        expand.appendChild(ed);
        expand.appendChild(ereact);
        expand.appendChild(cfb);
        expand.appendChild(ecs);
        expand.appendChild(eca);

        card.appendChild(expand);
        card.appendChild(com);
        card.appendChild(act);

        cl.appendChild(card);
      }

      return cid;
    }

    function makemeta(id){
      let wrap = document.createElement('div');
      wrap.className = 'br ignore';

      let metas = [{class: 'metatag', label:[1,2,3,4,5,6,7,8,9,0], path: 'M1 11.833v-8.77C1 1.923 1.923 1 3.063 1h8.77c.547 0 1.072.217 1.459.604l9.104 9.104a2.063 2.063 0 010 2.917l-8.77 8.77a2.063 2.063 0 01-2.918 0l-9.104-9.103A2.062 2.062 0 011 11.833zM5.813 3.75a2.062 2.062 0 100 4.125 2.062 2.062 0 000-4.125z'}, {class: 'metaeditor', label:['Dave B', 'Luke S', 'Mike J', 'Tony J', 'Ashley S', 'Fred B'], path: 'M16.377 5.394l3.445 3.445a.373.373 0 010 .527l-8.341 8.342-3.545.393a.743.743 0 01-.821-.821l.393-3.544 8.342-8.342a.373.373 0 01.527 0zm6.188-.875L20.7 2.655a1.494 1.494 0 00-2.109 0L17.24 4.007a.373.373 0 000 .528l3.445 3.445a.373.373 0 00.527 0l1.353-1.352c.58-.585.58-1.528 0-2.109zm-6.898 10.92v3.888H3.444V7.105h8.777a.47.47 0 00.325-.134l1.528-1.527a.458.458 0 00-.325-.783H2.833A1.834 1.834 0 001 6.494v13.444c0 1.013.821 1.834 1.833 1.834h13.445a1.834 1.834 0 001.833-1.834v-6.027a.46.46 0 00-.783-.324L15.8 15.114a.47.47 0 00-.133.325z'}, {class: 'metaupdated', label:['1D', '2W', '4D', '5D', '1M', '6M', '2M', '4D', '2D', '6D', '1W', '1H', '2H', '8H'], path: 'M12 1C5.923 1 1 5.923 1 12s4.923 11 11 11 11-4.923 11-11S18.077 1 12 1zm4.102 13.883l-.887 1.109a.71.71 0 01-.997.11l-2.972-2.204a1.773 1.773 0 01-.665-1.386v-6.9a.71.71 0 01.71-.709h1.419a.71.71 0 01.71.71V12l2.572 1.885a.708.708 0 01.11.998z'}, {class: 'metacreator', label:['Dave B', 'Luke S', 'Mike J', 'Tony J', 'Ashley S', 'Fred B'], path: 'M17.625 1l-2.75 1.375L12.125 1l-2.75 1.375L6.625 1v4.125h11V1zm-1.65 13.063h-.718a7.504 7.504 0 01-3.132.687 7.504 7.504 0 01-3.132-.688h-.718A5.775 5.775 0 002.5 19.837v1.1c0 1.14.923 2.063 2.063 2.063h15.125c1.139 0 2.062-.923 2.062-2.063v-1.1a5.775 5.775 0 00-5.775-5.774zm-3.85-1.376a5.5 5.5 0 005.5-5.5V6.5h-11v.688a5.5 5.5 0 005.5 5.5z'}, {class: 'metacreated', label:['1D', '2W', '4D', '5D', '1M', '6M', '2M', '4D', '2D', '6D', '1W'], path: 'M17.719 7.875H12.76l1.83-5.577A1.035 1.035 0 0013.595 1H7.406c-.515 0-.954.382-1.022.894L5.009 12.206c-.082.619.4 1.169 1.022 1.169h5.1l-1.98 8.357a1.03 1.03 0 001.895.752l7.562-13.062a1.03 1.03 0 00-.89-1.547z'}, {class: 'metareactions', label:['reacts'], path: 'M12 1.5C6.2 1.5 1.5 6.2 1.5 12S6.2 22.5 12 22.5 22.5 17.8 22.5 12 17.8 1.5 12 1.5zm5.987 16.487A8.41 8.41 0 0112 20.467a8.41 8.41 0 01-5.987-2.48A8.41 8.41 0 013.533 12c0-2.26.88-4.386 2.48-5.987A8.41 8.41 0 0112 3.533c2.26 0 4.386.88 5.987 2.48A8.41 8.41 0 0120.467 12a8.41 8.41 0 01-2.48 5.987zm-2.6-7.342c.75 0 1.355-.605 1.355-1.355s-.605-1.355-1.355-1.355-1.355.606-1.355 1.355c0 .75.606 1.355 1.355 1.355zm-6.774 0c.75 0 1.355-.605 1.355-1.355s-.606-1.355-1.355-1.355c-.75 0-1.355.606-1.355 1.355 0 .75.606 1.355 1.355 1.355zm8.23 2.71H7.156a.568.568 0 00-.571.635c.317 2.506 2.494 4.446 5.127 4.446h.576c2.633 0 4.81-1.94 5.127-4.446a.568.568 0 00-.572-.635z'}, {class: 'metacomments', label:[1 , 2 ,3 ,4 , 5,6,7,8,9], path: 'M19.778 2H4.222C2.99 2 2 2.9 2 4v14c0 1.1.989 2 2.222 2h4.445l3.166 2.85a.25.25 0 00.334 0L15.333 20h4.445C21 20 22 19.1 22 18V4c0-1.1-1-2-2.222-2zM8 8.65h2.256c.05-.94.683-1.548 1.64-1.548.949 0 1.582.575 1.582 1.366 0 .79-.325 1.198-1.399 1.84-1.149.674-1.607 1.423-1.498 2.73l.016.483h2.206v-.441c0-.816.308-1.224 1.415-1.865C15.393 10.524 16 9.65 16 8.393c0-1.898-1.573-3.222-3.954-3.222-2.556 0-4.004 1.432-4.046 3.48zm3.73 8.85c.757 0 1.365-.574 1.365-1.307s-.608-1.307-1.366-1.307c-.749 0-1.356.575-1.356 1.307 0 .733.607 1.307 1.356 1.307z'}, {class: 'metaactor', label:['Russia', 'China', 'Foreign', 'Domestic', 'Pacific', 'Kangaroos'], path: 'M5.813 9.6h-.825a.55.55 0 00-.55.55v3.3a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55v-3.3a.55.55 0 00-.55-.55zm-3.3 1.1h-.825a.55.55 0 00-.55.55v1.1a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55v-1.1a.55.55 0 00-.55-.55zm6.6-4.4h-.825a.55.55 0 00-.55.55v9.9a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55v-9.9a.55.55 0 00-.55-.55zm13.2 4.4h-.825a.55.55 0 00-.55.55v1.1a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55v-1.1a.55.55 0 00-.55-.55zm-3.3-5.5h-.826a.55.55 0 00-.55.55v12.1a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55V5.75a.55.55 0 00-.55-.55zm-3.3 2.2h-.825a.55.55 0 00-.55.55v7.7a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55v-7.7a.55.55 0 00-.55-.55zm-3.3-4.4h-.825a.55.55 0 00-.55.55v16.5a.55.55 0 00.55.55h.825a.55.55 0 00.55-.55V3.55a.55.55 0 00-.55-.55z'}, {class: 'metasource', label:['Intel', 'Wiki', 'Internal', 'Warno', 'XXX'], path: 'M12 1C5.923 1 1 5.923 1 12s4.923 11 11 11 11-4.923 11-11S18.077 1 12 1zm0 4.258a3.903 3.903 0 110 7.807 3.903 3.903 0 010-7.807zm0 15.258a8.5 8.5 0 01-6.498-3.025c.834-1.57 2.466-2.652 4.369-2.652.106 0 .213.018.315.048.576.187 1.18.306 1.814.306a5.85 5.85 0 001.814-.306c.102-.03.209-.048.315-.048 1.903 0 3.535 1.082 4.369 2.652A8.5 8.5 0 0112 20.516z'}, {class: 'metaid'}, {class: 'metauses', label: [1,2,3,4,5,6,7,8,9,0], path: 'M17.7188 7.875H12.7602L14.5907 2.29766C14.7626 1.64453 14.2684 1 13.5938 1H7.40634C6.89071 1 6.45243 1.38242 6.38368 1.89375L5.00868 12.2062C4.92704 12.825 5.40829 13.375 6.03134 13.375H11.1317L9.15087 21.7324C8.99618 22.3855 9.49462 23 10.152 23C10.513 23 10.8567 22.8109 11.0458 22.4844L18.6083 9.42188C19.0079 8.73867 18.5138 7.875 17.7188 7.875Z'} ];

      for(let i=0;i<metas.length;i++){
        let a = metas[i];
        let l = a.label ? a.label.random() : 'unknown';
        let c = a.class;
        let p = a.path;

        if (c == 'metaid'){
          l = 'ID-' + (id+1);
        }

        let m = document.createElement('div');
        m.className = 'meta ' + c;
        m.title = c.replace('meta', '');

        if ( p ){
          let s = document.createElementNS("http://www.w3.org/2000/svg", "svg");
          let path = document.createElementNS("http://www.w3.org/2000/svg", 'path');

          s.setAttribute('viewBox', '0 0 24 24');
          path.setAttribute('d', a.path);

          s.appendChild(path);
          m.appendChild(s);
        }

        let d = document.createElement('div');
        d.className = 'data';

        d.appendChild(document.createTextNode(l));

        m.appendChild(d);

        wrap.appendChild(m);
      }

      return wrap;
    }

    function generate() {
        var output = '';
        for (var i = 0; i < (10 + Math.random() * 1000); i++) {
            for (var j = 0; j < Math.floor(Math.random() * 13); j++) {
                var char = 65 + (Math.random() * 26);
                output += String.fromCharCode(char);
            }
            switch (Math.floor(Math.random() * 8)) {
                default:
                  output = output.trim();
                    output += " ";
                    break;
            }
        }
        if (output.substring(output.length - 1, output.length) == " ") {
            output = output.slice(0, -1);
            var l = output.substring(output.length - 1, output.length);
            if(l == ","){
                output = output.slice(0, -1);
            }else if(l == "."){
                output += "";
            }else{
                output += "."
            }
        };
        return output.toLowerCase();
    }

    function togglebtn(){
      let on = this.classList.contains('on');
      let c = this.dataset.class;
      if ( on ){
        this.classList.remove('on');
        document.body.classList.remove(c);

      } else {
        // document.getElementsByClassName('toggle on').removeclass('on');
        this.classList.add('on');
        document.body.classList.add(c);

        if ( c == 'clopen'){
          if ( window.clwindow){
            window.clwindow.close();
          }
        }
      }
    }

    function closetab(e){
      e.preventDefault();
      e.stopPropagation();
    }

    function tab(){
      // if ( this.classList.contains('current')){
        
        if ( !this.classList.contains('logo') && !this.classList.contains('pop2')){
          let p = document.getElementById('tabpop').cloneNode(true);
          p.removeAttribute('id');
          p.style.left = '50%';
          p.style.transform = 'translateX(-50%)';
          this.appendChild(p);
          this.classList.add('pop2');

        }

        // return;
      // }

      if ( this.classList.contains('current') ){
        this.classList.toggle('on');
      } else {
        document.getElementsByClassName('tab current').removeclass('current');
        document.getElementsByClassName('tab on').removeclass('on');
        this.classList.add('current');
      }
      


      

      // this.classList.remove('on');

      let v = this.dataset.view;

      // document.getElementById('container').className = v;

      let o = document.getElementsByClassName('view show');
      o.removeclass('show');

      let view = document.getElementById(v);

      view.classList.add('show');

      if ( window.clwindow){
        window.clwindow.focus();
      }


      removebounding();
    }

    function filtercards(e){
      let v = this.value.toLowerCase().trim();

      console.log(v);

      let cards = document.getElementsByClassName('card');

      for(let i=0;i<cards.length;i++){
        let card = cards[i];
        let kt = card.getElementsByClassName('keytag')[0].innerText;
        let mr = card.getElementsByClassName('mr')[0].innerText;

        if ( kt.toLowerCase().indexOf(v) >= 0 ){
          card.classList.remove('hide');
        } else if (mr.toLowerCase().indexOf(v) >= 0){
          card.classList.remove('hide');
        } else {
          card.classList.add('hide');
        }
      }
    }

    function popbtn(){
      if (this.classList.contains('on')) {
        this.classList.remove('on');
      } else {
        document.getElementsByClassName('pop on').removeclass('on');
        this.classList.add('on');
      }

    }

    function ctoggle(e){
      let v = this.value;

      let cl = document.getElementById('cl');
      let x = false;
      if ( this.checked ){
        cl.classList.add(v);
        x = true;
      } else {
        cl.classList.remove(v);
      }

      localStorage[v] = x;
    }

    function cradio(e){
      let cl = document.getElementById('cl');
      let g = this.name;
      let r = document.getElementsByName(g);

      for(var i=0;i<r.length;i++){
        let rad = r[i];
        let v = rad.value;
        let x = false;
        if ( rad.checked ){
          cl.classList.add(v);
          x = true;
        } else {
          cl.classList.remove(v);
        }
        localStorage[v] = x;
      }
    }

    function bodyclick(e){
      let nonpop = false;
      let tars = document.elementsFromPoint(e.clientX, e.clientY);

      tars.forEach(tar => {
        if ( tar.classList.contains('popover') || tar.classList.contains('pop')){
          nonpop = true
          return;
        }
      });

      if ( !nonpop ){
        document.getElementsByClassName('pop on').removeclass('on');
      }
    }

    function restorecustom(){
      if (localStorage.ctag == 'true' || localStorage.ctag === undefined ) document.getElementById('ctag').click();
      if (localStorage.ceditor == 'true' || localStorage.ceditor === undefined ) document.getElementById('ceditor').click();
      if (localStorage.cupdated == 'true' ) document.getElementById('cupdated').click();
      if (localStorage.ccreator == 'true' ) document.getElementById('ccreator').click();
      if (localStorage.ccreated == 'true' ) document.getElementById('ccreated').click();
      if (localStorage.creactions == 'true' ) document.getElementById('creactions').click();
      if (localStorage.ccomments == 'true' ) document.getElementById('ccomments').click();
      if (localStorage.cuses == 'true' ) document.getElementById('cuses').click();
      if (localStorage.cactor == 'true' ) document.getElementById('cactor').click();
      if (localStorage.csource  == 'true') document.getElementById('csource').click();
      if (localStorage.cid == 'true' ) document.getElementById('cid').click();

      if (localStorage.c2l == 'true' || localStorage.c2l === undefined ) document.getElementById('c2l').click();
      if (localStorage.c4l == 'true' ) document.getElementById('c4l').click();
    }

    function blurmr(e){
      console.log('blurup');
      console.log(document.activeElement, e.target);

      window.removefloat = setTimeout(function(){
        document.getElementsByClassName('floatinglib').remove();
      }, 55);
        let dc = this.getparent('dragcard');
        dc.classList.remove('editing');
        this.contentEditable = false;
        this.classList.add('ignore');

        if (dc.dataset.blank == 'true'){
          let id = dc.dataset.id;
          dc.remove();

          document.getElementById(id).remove();

          return;
        }
    }

    function keypress(e){
      console.log(e.keyCode);
      let k = e.keyCode;
      if ( k == 8 || k == 46){
        if ( document.activeElement.tagName !== 'TEXTAREA' && document.activeElement.tagName !== 'INPUT' && !document.activeElement.classList.contains('mr') ){
          document.getElementsByClassName('dragcard focused').remove();
        }
      }
    }

    function carddb(e){
      console.log('db');

      // let clbtn = document.getElementsByClassName('clbtn')[0];
      // if ( !clbtn.classList.contains('on') ){
      //   clbtn.click();

      //   let id = this.dataset.id;

      //   let card = document.getElementById(id);
      //   card.classList.add('expanded');

      //   card.scrollIntoViewIfNeeded(false);
      // }

      //modal
        let o = document.createElement('div');
      let fi = document.createElement('div');

      o.className = 'overlay';
      fi.className = 'modal';

      o.onclick = function(e){
        if ( e.target.classList.contains('overlay')) {
          this.remove();
        }
      }
      
      let a = document.getElementById(this.dataset.id);
      a.classList.add('expanded');
      
      let c = a.cloneNode(true);
      
      
      c.removeAttribute('id');
      
      fi.appendChild(c);
      o.appendChild(fi);
      document.body.appendChild(o);

      let txa = o.getElementsByTagName('textarea')[0];
                ta.call(txa);
                txa.focus();
    }

    function ta(e, ignore = false){
      this.style.height = 0;
      let sh = this.scrollHeight;

      this.style.height = sh + 4 + 'px';

      if ( this.classList.contains('ta') && !ignore ){
        let c = this.getparent('card');
        let id = c.dataset.id;
        let cards = document.querySelectorAll(`[data-id="${id}"]`);
        for(var i=0;i<cards.length;i++){ 
          let mr = cards[i].getElementsByClassName('mr')[0];
          mr.empty();
          mr.appendChild(document.createTextNode(this.value))
        }
      }
    }

    function popout(){
      window.popoutwindow = window.open("./index.html#popwindow", "Card Popover", "toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=666,height="+(Math.min(window.screen.height-300, 696))+",top="+((window.screen.height /2) - 448)+",left="+((window.screen.width/2) -333));

      let cid = this.getparent('card').dataset.id;

      window.popoutwindow.onload = function(){
        let cl = window.popoutwindow.document.getElementsByClassName('cardlist')[0];
        let p = cl.parentElement;
        let clone = document.getElementsByClassName('cardlist')[0].cloneNode(true);
        cl.remove();
        p.appendChild(clone);

        window.popoutwindow.document.body.classList.add('popoutwindow');

        let c = clone.getElementsByClassName('card');
        for(var i=0;i<c.length;i++){
          let card = c[i];
          if ( card.dataset.id == cid){
            card.draggable = true;
            card.classList.add('expanded');
            card.style.boxShadow = 'none';
            card.offsetLeft;
            card.style.border = 'none';
            window.popoutwindow.resizeTo(666, card.offsetHeight+80);
          } else {
            card.style.display = 'none';
          }
        }

        
      }
      // document.close();
    }

    function popwindow(){
      window.clwindow = window.open("./index.html#popwindow", "Card Library", "toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=336,height="+(window.screen.height- 300)+",top="+(100)+",left="+(window.screen.width-400));

      window.clwindow.onload = function(){
        let cl = window.clwindow.document.getElementsByClassName('cardlist')[0];
        let p = cl.parentElement;
        let clone = document.getElementsByClassName('cardlist')[0].cloneNode(true);
        cl.remove();
        p.appendChild(clone);

        let c = clone.getElementsByClassName('card');
        for(var i=0;i<c.length;i++){
          let card = c[i];
          card.draggable = true;
          card.classList.add('popcard');
          card.classList.remove('expanded');
        }
      }
      document.close();
    }

    function openpop(){
      if ( window.clwindow){
        window.clwindow.focus();
      }

      document.getElementsByClassName('clbtn')[0].click(); 
      popwindow();
    }

    function popcorn(){
      if ( location.hash == '#popwindow'){
        document.body.classList.add('popwindow');
        let c = document.getElementsByClassName('card');
        for(var i=0;i<c.length;i++){
          let card = c[i];
          card.draggable = true;
        }
      }

      window.onunload = function() {
        console.log('fsdfs')
        var win = window.opener;
          if (!win.closed) {
              win.someFunctionToCallWhenPopUpCloses();
          }
      };
    }

    function colorset(x){
      console.log('colorset', x)
    }

    function dragStart(e) {
      let text = this.getElementsByClassName('mr')[0].cloneNode(true);
      let keytag = this.getElementsByClassName('keytag')[0];
      let bg = window.getComputedStyle(keytag).backgroundColor;

      let dragcard = document.createElement('div');
      dragcard.className = 'dragcard focused';
      dragcard.style.backgroundColor = bg;
      let kt = keytag.cloneNode(true);
      kt.style.backgroundColor = 'rgba(0,0,0,0.1)';
      dragcard.appendChild(kt);
      dragcard.appendChild(text);

      document.body.appendChild(dragcard);

      e.dataTransfer.effectAllowed = 'copy';
  
      e.dataTransfer.setData("text/plain", e.target.dataset.id);
      e.dataTransfer.setDragImage(dragcard, 0, 0);

      let t = this;

      document.addEventListener('mousemove', dragMove);
      document.addEventListener('mouseup', dragEnd);

      window.dropcardheight = dragcard.offsetHeight + 'px';

      function dragMove(e) {
     
      }

      function dragEnd(e) {
        document.removeEventListener('mousemove', dragMove);
        document.removeEventListener('mouseup', dragEnd);
        
      }
    }

    function handleDrop(e) {
      e.preventDefault();
      e.stopPropagation();

      console.log(e.clientY, 'clienty')

      let id = e.dataTransfer.getData('text/plain');
      console.log(id , 'dsfsdf');

      document.getElementsByClassName('dragcard focused').removeclass('focused');

      let card = document.getElementById(id);
      let text = card.getElementsByClassName('mr')[0].cloneNode(true);
      let keytag = card.getElementsByClassName('keytag')[0];

      let ktt = keytag.innerText.toLowerCase();

      let foundIndex = KEYTAGS.findIndex(x => x.text == ktt);
      let KT = KEYTAGS[foundIndex];
      let bg = KT.color;
      let cc = KT.tcolor;

      let dragcard = document.createElement('div');
      dragcard.className = 'dragcard focused';
      dragcard.style.backgroundColor = bg;
      dragcard.style.color = cc;
      let kt = keytag.cloneNode(true);
      kt.style.backgroundColor = bg;//'rgba(0,0,0,0.1)';
      dragcard.dataset.id = id;
      dragcard.style.position = 'static';
      dragcard.appendChild(kt);
      dragcard.appendChild(text);

      let slide = this.classList.contains('slide');

      if ( slide ){
        dragcard.style.position = 'absolute';
        dragcard.style.top = e.clientY - this.getBoundingClientRect().y + 'px';
        dragcard.style.left = e.clientX - this.getBoundingClientRect().x + 'px';
      }
      
      // this.appendChild(dragcard);

      let y = e.clientY;

      let lists = this.getElementsByClassName('dragcard');
      let inserted = false;

      for(var i=0;i<lists.length;i++){
        let l = lists[i];
        let lof = l.getBoundingClientRect().y;

        if ( y < lof ){
          inserted = true;
          l.parentElement.insertBefore(dragcard,l);
          break;
        }
      }

      document.getElementsByClassName('cardspacer').remove();

      if (!inserted){
        this.appendChild(dragcard);
      }

      this.classList.remove('draggingover');
      if ( window.clwindow){
        window.clwindow.focus();
      }
    }

    function handleDragOver(e) {
      e.preventDefault();
      
      e.dataTransfer.dropEffect = 'copy';

      let s = this.getElementsByClassName('cardspacer')[0];

      let y = e.clientY;

      if ( this.classList.contains('list')){

        let lists = this.getElementsByClassName('dragcard');
        let inserted = false;

        for(var i=0;i<lists.length;i++){
          let l = lists[i];
          let lof = l.getBoundingClientRect().y;

          if ( y < lof ){
            inserted = true;
            l.parentElement.insertBefore(s,l);
            break;
          }
        }

        if (!inserted){
          this.appendChild(s);
        }
      }

    }

    function handleDragEnter(e) {
      this.classList.add('draggingover');

      let spacer = document.createElement('div');
      spacer.className = 'cardspacer';
      spacer.style.height = window.clwindow ? window.clwindow.dropcardheight : '100px';

      this.appendChild(spacer);
    }

    function handleDragLeave(e) {
      this.classList.remove('draggingover');

      document.getElementsByClassName('cardspacer').remove();
    }

    function handleDragEnd(e) {
      this.classList.remove('draggingover');
      document.getElementsByClassName('cardspacer').remove();
    }

    function someFunctionToCallWhenPopUpCloses(){
      let clbtn = document.getElementsByClassName('clbtn')[0];
      if ( !clbtn.classList.contains('on')){
        clbtn.click();
      }
    }

    function cardclick(e){
      document.getElementsByClassName('expanded').removeclass('expanded');
      this.classList.add('expanded');
      let txa = this.getElementsByTagName('textarea')[0];
                ta.call(txa);
                txa.focus();
      this.scrollIntoViewIfNeeded(false);
    }

    function minbtn(e){
      this.getparent('expanded').classList.remove('expanded');
    }

    function deleteallcards(x){
      let l = x.length;
      let all = [];
      let tc = 0;
      for(var i=0;i<l;i++){
        let og = x[i].getparent('card');
        let id = og.dataset.id;

        let cards = document.querySelectorAll(`[data-id="${id}"]`);
        let count = cards.length;
        for(var ii=0;ii<count;ii++){
          cards[ii].classList.add('archived');
          tc++;
        }
        
        og.classList.add('archived');

        all.push(`[data-id="${id}"]`);
      }

      document.getElementsByClassName('overlay').remove();

      maketoast(`Removed ${l} card in ${tc} locations`, 'Undo', all, unarchive);
    }

    function deletecards(e){
      let c = document.querySelectorAll('input.check:checked');

      if ( !c.length){
        return;
      }
      
      deleteallcards(c);
      document.getElementsByClassName('selectall')[0].checked = false;
    }

    function deletecard(e){      
      deleteallcards([this]);
    }

    function unarchive(e){
      let all = this.dataset.all;

      let query = document.querySelectorAll(all);

      for(var i=0;i<query.length;i++){
        query[i].classList.remove('archived');
      }
    }

    function maketoast(m, a, all, c){

      let t = document.createElement('div');
      let w = document.createElement('div');
      let b = document.createElement('div');

      t.className = 'toast';

      b.className = 'btn toastundo';
      b.onclick = c;
      b.dataset.all = all.join(',');
      b.appendChild(document.createTextNode(a));

      b.addEventListener('click', function(){
        t.remove();
      })

      w.className = 'message';
      w.appendChild(document.createTextNode(m));

      t.appendChild(w);
      t.appendChild(b);

      document.body.appendChild(t);

      t.timer = setTimeout(function(){t.remove()}, 5000);
    }

    function selectall(e){
      if ( this.checked ){
        let c = document.querySelectorAll('input.check:not(:checked)');
        let l = c.length;
        for(var i=0;i<l;i++){
          c[i].checked = true;
        }
      } else {
        let c = document.querySelectorAll('input.check:checked');
        let l = c.length;
        for(var i=0;i<l;i++){
          c[i].checked = false;
        }
      }
    }

    function lockbtn(){
      this.getparent('card').classList.toggle('locked');
    }

    function activitybtn(){
      this.getparent('card').classList.toggle('aactive');
    }

    function commentbtn(){
      this.getparent('card').classList.toggle('cactive');
    }

    function closebtn(){
      this.getparent('card').classList.remove(this.dataset.class);
    }

    function draglist(e){
      if ( e.which == 3 || this.draggable || !e.target.classList.contains('list') && !e.target.classList.contains('listtag') ){
        return;
      }
      let t = this;
      let lc = this.getparent('listcontainer');
      let et = e.target;
      let moved = false;

      let sx = e.clientX;
      let sl = document.getElementById('p1').scrollLeft;

      let ol = t.offsetLeft;
      let w = t.offsetWidth;
      let g = 12;

      let clone = this.cloneNode(true);

      document.body.classList.add('mousegrab');

      t.style.opacity = 0;

      clone.style.position = 'absolute';
      clone.style.left = ol - sl +'px';
      clone.style.zIndex =  999999999;
      clone.style.backgroundColor = 'rgb(213 207 252)';
      clone.classList.add('clone');

      t.parentElement.appendChild(clone);

      function move(e){
        let x = e.clientX;

        let nx = sx - x;

        if ( !moved && Math.abs(nx) < 5 ){
          return;
        }

        moved = true;

        clone.style.left = ol - nx - sl +'px';

        let lists = lc.getElementsByClassName('list');
        let inserted = false;

        for(var i=0;i<lists.length;i++){
          let l = lists[i];
          let lof = l.offsetLeft;

          if (l.classList.contains('clone')){
            continue;
          }

          if ( ol - nx < lof ){
            inserted = true;
            if ( t !== l ){
              l.parentElement.insertBefore(t,l);
              return;
            }
          }
        }

        if (!inserted){
          lc.appendChild(t);
        }
      }

      function end(e){
        document.removeEventListener('mousemove', move);
        document.removeEventListener('mouseup', end);

        document.body.classList.remove('mousegrab');

        t.style.opacity = 1;
        clone.remove();

        let tars = document.elementsFromPoint(e.clientX, e.clientY);

        if ( !moved ){
          console.log(et, e.target);
          if ( e.target.classList.contains('listtag') ){
            console.log('color');

            et.getElementsByClassName('popover').remove();

            let colorpop = document.getElementById('colorpop').cloneNode(true);
            colorpop.style.left = '0px';
            colorpop.removeAttribute('id');
            et.appendChild(colorpop);

            et.classList.add('on');

            return;
          }

          let ff = document.getElementsByClassName('dragcard focused');
          ff.removeclass('focused');

          let list = t.getparent('list');
          let lt = list.getElementsByClassName('listtag');
          let tagg = lt.length ? lt[0].dataset.tag.toLowerCase() : list.getElementsByClassName('taginput')[0].dataset.tag;

          var foundIndex = KEYTAGS.findIndex(x => x.text == tagg);
          console.log(foundIndex, KEYTAGS[foundIndex], 'fff');


          let KT = KEYTAGS[foundIndex] || {color: 'rgb(221, 221, 221)', tcolor: 'black', text: tagg};
          let kc = KT.color;
          let kx = KT.tcolor;

          let cid = makecards(1, true, KT);
          dragcard = document.createElement('div');
          dragcard.className = 'dragcard editing';
          let kt = document.createElement('div');
          let mr = document.createElement('div');
          dragcard.style.position = 'static';
          dragcard.style.pointerEvents = 'all';
          dragcard.style.cursor = 'grab';
          dragcard.style.background = kc;
          dragcard.style.color = kx;
          dragcard.dataset.blank = true;
          mr.className = 'mr';
          mr.contentEditable = true;
          dragcard.dataset.id = cid;
          kt.className = 'keytag ignore';
          kt.dataset.tag = tagg;
          kt.style.backgroundColor = kc;
          kt.style.color = kx;
          kt.appendChild(document.createTextNode(tagg));
          dragcard.appendChild(kt);
          dragcard.appendChild(mr);

          let y = e.clientY;

          let lists = t.getElementsByClassName('dragcard');
          let inserted = false;

          for(var i=0;i<lists.length;i++){
            let l = lists[i];
            let lof = l.getBoundingClientRect().y;

            if ( y < lof ){
              inserted = true;
              l.parentElement.insertBefore(dragcard,l);
              break;
            }
          }

          if (!inserted){
            t.appendChild(dragcard);
          }

          // t.appendChild(dragcard);

          mr.focus();

        }
      }

      document.addEventListener('mousemove', move);
      document.addEventListener('mouseup', end);
    }

    function makeeditcard(e){
      document.getElementsByClassName('focused').removeclass('focused');

      let list = this.getparent('list');
      let lt = list.getElementsByClassName('listtag');
      let tagg = lt.length ? lt[0].dataset.tag.toLowerCase() : list.getElementsByClassName('taginput')[0].dataset.tag;
      var foundIndex = KEYTAGS.findIndex(x => x.text == tagg);
      console.log(foundIndex, KEYTAGS[foundIndex], 'fffffff');

      let KT = KEYTAGS[foundIndex] || {color: 'rgb(221, 221, 221)', tcolor: 'black', text: tagg};
      let kc = KT.color;
      let kx = KT.tcolor;

      let cid = makecards(1, true, KT);
      dragcard = document.createElement('div');
      dragcard.className = 'dragcard editing';
      let kt = document.createElement('div');
      let mr = document.createElement('div');
      dragcard.style.position = 'static';
      dragcard.style.pointerEvents = 'all';
      dragcard.style.cursor = 'grab';
      dragcard.style.background = kc;
      dragcard.style.color = kx;
      dragcard.dataset.blank = true;
      mr.className = 'mr';
      mr.contentEditable = true;
      dragcard.dataset.id = cid;
      kt.className = 'keytag ignore';
      kt.dataset.tag = tagg;
      kt.style.backgroundColor = kc;
      kt.style.color = kx;
      kt.appendChild(document.createTextNode(tagg));

      dragcard.appendChild(kt);
      dragcard.appendChild(mr);

      this.parentElement.appendChild(dragcard);
     
      mr.focus();
    }

    function dragtab(e){
      if ( e.which == 3 || this.draggable || !e.target.classList.contains('tab') && !e.target.classList.contains('listtag') ){
        return;
      }
      let t = this;
      let et = e.target;
      let moved = false;

      let sx = e.clientX;
      let sl = 0;//document.getElementById('p1').scrollLeft;

      let ol = t.offsetLeft;
      let w = t.offsetWidth;
      let g = 12;

      let clone = this.cloneNode(true);

      document.body.classList.add('mousegrab');


      clone.style.position = 'absolute';
      clone.style.left = ol - sl +'px';
      clone.style.zIndex =  999999999;
      // clone.style.backgroundColor = '#b3d8f0';

      

      function move(e){
        let x = e.clientX;

        let nx = sx - x;

        if ( !moved && Math.abs(nx) < 5 ){
          return;
        } else if(!moved){
          t.style.opacity = 0;
          t.parentElement.appendChild(clone);
        }

        moved = true;

        clone.style.left = ol - nx - sl +'px';

        let lists = document.getElementsByClassName('tab closeable');
        let inserted = false;

        for(var i=0;i<lists.length;i++){
          let l = lists[i];
          let lof = l.offsetLeft;

          if ( ol - nx < lof ){
            inserted = true;
            l.parentElement.insertBefore(t,l);
            return;
          }
        }

        if (!inserted){
          lists[lists.length-1].parentElement.appendChild(t);
        }

      }

      function end(e){
        document.removeEventListener('mousemove', move);
        document.removeEventListener('mouseup', end);

        document.body.classList.remove('mousegrab');

        t.style.opacity = 1;
        clone.remove();

        let tars = document.elementsFromPoint(e.clientX, e.clientY);

        if ( !moved ){
          tab.call(t, e);

        }
      }

      document.addEventListener('mousemove', move);
      document.addEventListener('mouseup', end);
    }

    function ktitem(){
      let kt = this.getElementsByClassName('keytag')[0];

      let card = this.getparent('card');
      let id = card.dataset.id;
      let t = card.getElementsByClassName('tagdrop')[0];
      let k = t.getElementsByClassName('keytag')[0];

      let nk = kt.cloneNode(true);
      
      t.insertBefore(nk, k);
      k.remove();

      let tt = kt.innerText.toLowerCase();

      let foundIndex = KEYTAGS.findIndex(x => x.text == tt);
        let KT = KEYTAGS[foundIndex];
        let bg = KT.color;
        let cc = KT.tcolor;

      // let bg = window.getComputedStyle(nk).backgroundColor;

      let cards = document.querySelectorAll(`[data-id="${id}"]`);

      for(var i=0;i<cards.length;i++){ 
        let c = cards[i];
        
        let ks = c.getElementsByClassName('keytag');

        for(var ii=0;ii<ks.length;ii++){
          let k = ks[ii];

          if ( k.getparent('popover')){
            continue;
          }
          let p = k.parentElement;
          let kk = kt.cloneNode(true);
          
          p.insertBefore(kk, k);
          k.remove();   

          if ( c.classList.contains('dragcard')){
            c.style.backgroundColor = bg;
            c.style.color = cc;
            // kk.style.backgroundColor = 'rgba(0,0,0,0.1)';
          }
        }
      }
    }

    function dragscroll(e){
      let sl = this.scrollLeft;
      let st = this.scrollTop;

      let sx = e.clientX;
      let sy = e.clientY;

      let t = this;

      if(!e.target.classList.contains('dragscroll') && !e.target.classList.contains('xxx') && !e.target.classList.contains('listcontainer')){
        return;
      }

      function move(e){
        let x = e.clientX;
        let y = e.clientY;
        let nx = x - sx;
        let ny = y - sy;

        t.scrollLeft = sl - nx;
        t.scrollTop = st - ny;
      }

      function end(e){
        document.removeEventListener('mousemove', move);
        document.removeEventListener('mouseup', end);
      }

      document.addEventListener('mousemove', move);
      document.addEventListener('mouseup', end);
    }

    function newplan(){


    }

    function planswap(){
      let t = this.innerText;      
    }

    function newview(c, x){
      let b = document.createElement('div');
      let v = 'p' + document.getElementsByClassName('view').length;
      b.className = 'view ' + c;
      b.id = v;

      if ( x ){
        b.appendChild(x);
      }

      document.getElementById('container').appendChild(b);

      return v;
    }

    function newboard(){
      let s = document.createElement('section');
      let c = document.createElement('div');
      let b = document.createElement('div');
      let r = document.createElement('div');

      s.style.display = 'flex';
      
      c.className = 'listcontainer';

      b.className = 'btn listbtn addlist';
      b.appendChild(document.createTextNode('Add list'));

      r.className = 'spacer';

      newlist.call(c)
      s.appendChild(c);
      s.appendChild(b);
      s.appendChild(r);

      let v = newview('xxx', s);
      newtab('Phase ' + romanize(Number(document.getElementsByClassName('tab board').length) + 1), 'board', v);
    }

    function newlist(tt, add = false){
      let x = document.createElement('div');
      let t = document.createElement('div');
      let m = document.createElement('div');

      x.className = 'list';
      let a = tt || 'uncategorized';
      t.appendChild(document.createTextNode(a));
      t.className = 'listtag pop';
      t.dataset.tag = a;
      m.className = 'listmenu btn';

      let g = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      let path = document.createElementNS("http://www.w3.org/2000/svg", 'path');

      g.setAttribute('viewBox', '0 0 512 512');
      path.setAttribute('d', 'M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z');
      path.setAttribute('fill', 'currentColor');

      g.appendChild(path);

      m.appendChild(g);

      x.appendChild(t);
      x.appendChild(m);

      this.appendChild(x);
    }

    function romanize(num) {
      if (isNaN(num))
          return NaN;
      var digits = String(+num).split(""),
          key = ["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM",
                "","X","XX","XXX","XL","L","LX","LXX","LXXX","XC",
                "","I","II","III","IV","V","VI","VII","VIII","IX"],
          roman = "",
          i = 3;
      while (i--)
          roman = (key[+digits.pop() + (i * 10)] || "") + roman;
      return Array(+digits.join("") + 1).join("M") + roman;
    }

    function newtimeline(){
      let x = document.createElement('div');
     
      let v = newview('dragscroll', x);
      newtab('Untitled timeline', 'timeline', v);
    }

    function newce(){
      let x = document.createElement('div');
     
      let v = newview('dragscroll', x);
      newtab('Untitled cause & effect', 'ce', v);
    }

    function newbrief(){
      let x = document.createElement('div');

      x.innerHTML = `<div class=deck>
            <div class=minislide></div>
          </div>
          <div class=slidecanvas>
            <div class=slide>

            </div>
          </div>`;
     
      let v = newview('dragscroll', x);
      newtab('Untitled brief', 'brief', v);
    }

    function neworders(){
      let x = document.createElement('div');
     
      let v = newview('dragscroll', x);
      newtab('Untitled orders', 'orders', v);
    }

    function newscratch(){
      let x = document.createElement('div');
      x.className = 'scratchpad';
      let v = newview('dragscroll', x);
      newtab('Untitled scratch', 'scratch', v);
    }

    function newtab(x, c, v){
      let t = document.createElement('div');
      t.className = `tab ${c} closeable`;
      t.dataset.view = v;
      t.appendChild(document.createTextNode(x));

      let tabs = document.getElementById('tabwrap');

      let b = document.createElement('div');
      b.className = 'btn xbtn';

      let s = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      let path = document.createElementNS("http://www.w3.org/2000/svg", 'path');

      s.setAttribute('viewBox', '0 0 24 24');
      path.setAttribute('d', 'M14.87 12.002l4.3-4.3a1.352 1.352 0 000-1.91l-.956-.956a1.352 1.352 0 00-1.912 0l-4.3 4.3-4.3-4.3a1.352 1.352 0 00-1.91 0l-.956.955a1.352 1.352 0 000 1.912l4.3 4.3-4.3 4.3a1.352 1.352 0 000 1.91l.955.956a1.352 1.352 0 001.912 0l4.3-4.3 4.3 4.3a1.352 1.352 0 001.91 0l.956-.955a1.352 1.352 0 000-1.912l-4.3-4.3z');

      s.appendChild(path);
      b.appendChild(s);

      t.appendChild(b);

      tabs.appendChild(t);

      // t.click();

      tab.call(t,{});
    }

    function resizecl(e){
      e.preventDefault();
      e.stopPropagation();

      let sx = e.clientX;
      let cl = document.getElementById('cl');
      let cw = document.getElementById('conwrap');
      let w = cl.offsetWidth;

      function move(e){
        let x = e.clientX;

        let nx = sx - x;

        cl.style.width = w + nx + 'px';

        cw.style.right = w + nx + 'px';
      }

      function end(e){
        document.removeEventListener('mousemove', move);
        document.removeEventListener('mouseup', end);
      }

      document.addEventListener('mousemove', move);
        document.addEventListener('mouseup', end);
    }

    function sanitizeContenteditable(e) {
      console.log(e.which, e.keyCode, 'san');
      let keycode = e.keyCode;
      var allowedKeys =  (
              e.which === 8 ||  /* BACKSPACE */
              e.which === 35 || /* END */
              e.which === 36 || /* HOME */
              e.which === 37 || /* LEFT */
              e.which === 38 || /* UP */
              e.which === 39 || /* RIGHT*/
              e.which === 40 || /* DOWN */
              e.which === 46 || /* DEL*/
              e.ctrlKey === true && e.which === 65 || /* CTRL + A */
              e.ctrlKey === true && e.which === 88 || /* CTRL + X */
              e.ctrlKey === true && e.which === 67 || /* CTRL + C */
              e.ctrlKey === true && e.which === 86 || /* CTRL + V */
              e.ctrlKey === true && e.which === 90 ||   /* CTRL + Z */
              (keycode > 47 && keycode < 58)   || // number keys
              (keycode > 64 && keycode < 91)   || // letter keys
              (keycode > 95 && keycode < 112)  || // numpad keys
              (keycode > 185 && keycode < 193) || // ;=,-./` (in order)
              (keycode > 218 && keycode < 223) || // [\]' (in order)
              keycode == 32 //Space
          );

        //   (keycode > 47 && keycode < 58)   || // number keys
        // keycode == 32 || keycode == 13   || // spacebar & return key(s) (if you want to allow carriage returns)
        // (keycode > 64 && keycode < 91)   || // letter keys
        // (keycode > 95 && keycode < 112)  || // numpad keys
        // (keycode > 185 && keycode < 193) || // ;=,-./` (in order)
        // (keycode > 218 && keycode < 223);   // [\]' (in order)
      

      // if (e.type === 'paste') {
      //     setTimeout(function () {
      //         $(e.target).text($(e.target).text().slice(0, limit));
      //     });
      // }

      if (!allowedKeys) {
          e.preventDefault();
        if ( keycode == 13 || keycode == 27 ){ // enter && esc
          let text = this.innerText;
          document.activeElement.blur();
          console.log(text, 'text');
          if ( text !== ''){
            makeeditcard.call(this.getparent('dragcard'), e);
          }
        }
      } else {
        this.getparent('dragcard').dataset.blank = false;
      }
    }

    function mrup(e){
      let t = this.innerText;

      let c = this.getparent('dragcard');
      let id = c.dataset.id;

      let card = document.getElementById(id);
      let mr = card.getElementsByClassName('mr')[0];
      let txa = card.getElementsByClassName('ta')[0];

      txa.value = t;
      ta.call(txa, e, true);
      mr.empty();
      mr.appendChild(document.createTextNode(t));

      findcards.call(c, t);
    }

    function findcards(x){
      let v = x.toLowerCase().trim();

      let cards = document.getElementById('cl').getElementsByClassName('card');

      let arr = [];

      for(let i=0;i<cards.length;i++){
        let card = cards[i];
        let kt = card.getElementsByClassName('keytag')[0].innerText;
        let mr = card.getElementsByClassName('mr')[0].innerText;

        let ex = false;

        if ( kt.toLowerCase().indexOf(v) >= 0 ){
          ex = true;
        } else if (mr.toLowerCase().indexOf(v) >= 0){
          ex = true;
        } else {

        }

        if ( ex && card.dataset.id != this.dataset.id ){
          arr.push(card);
        }
      }

      document.getElementsByClassName('floatinglib').remove();

      if ( !arr.length){
        return;
      }

      let float = document.createElement('div');
      float.className = 'floatinglib';

      float.style.left = this.offsetLeft + 'px';
      float.style.top = this.offsetHeight + this.getBoundingClientRect().y + 12 + 'px';

      let tt = this;

      for(var i=0;i<Math.min(arr.length, 5);i++){
        let a = arr[i];

        let c = a.cloneNode(true);
        c.removeAttribute('id');
        c.classList.remove('expanded');

        c.onmousedown = function(e){
          e.preventDefault();

          let text = this.getElementsByClassName('mr')[0].cloneNode(true);
          let keytag = this.getElementsByClassName('keytag')[0];

          let foundIndex = KEYTAGS.findIndex(x => x.text == keytag.innerText.toLowerCase());
          let KT = KEYTAGS[foundIndex] || {color: 'rgb(221, 221, 221)', tcolor: 'black',  text: keytag.innerText.toLowerCase()};
          let bg = KT.color;
          let kc = KT.tcolor;

          let dragcard = document.createElement('div');
          dragcard.className = 'dragcard';
          dragcard.style.backgroundColor = bg;
          dragcard.style.color = kc;
          let kt = keytag.cloneNode(true);
          dragcard.dataset.id = this.dataset.id;
          dragcard.appendChild(kt);
          dragcard.appendChild(text);
          dragcard.style.position = 'static';
          dragcard.style.pointerEvents = 'all';
          dragcard.style.cursor = 'grab';
          dragcard.style.zIndex = 9999;

          tt.parentNode.appendChild(dragcard);

          let id = tt.dataset.id;

          if ( tt && tt.getElementsByClassName('mr')[0].innerText != '' ){
            tt.parentNode.removeChild(tt);
          }

          let oc = document.querySelector('.card[data-id="' + id +'"]');
          oc.remove();
        }
      
        float.appendChild(c);
      }

      document.body.appendChild(float);
    }

    function addlist(e){

      let c = this.parentElement.getElementsByClassName('listcontainer')[0];

      let l = document.createElement('div');
      let t = document.createElement('input');
      l.className = 'list';

      t.type = 'text';
      t.className = 'taginput';
      t.placeholder = 'Enter tag...';
      t.dataset.tag = 'untaged' + document.getElementsByClassName('list').length;

      let m = document.createElement('div');
      m.className = 'listmenu btn';

      let g = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      let path = document.createElementNS("http://www.w3.org/2000/svg", 'path');

      g.setAttribute('viewBox', '0 0 512 512');
      path.setAttribute('d', 'M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z');
      path.setAttribute('fill', 'currentColor');

      g.appendChild(path);

      m.appendChild(g);

      t.onkeydown = function(e){
        if ( e.keyCode == 13){
          let v = this.value;
          if ( v.trim() == ''){
            return;
          }
          let tt = v.trim().toLowerCase();
          let tag = document.createElement('div');
          tag.className = 'listtag pop';
          tag.dataset.tag = tt;
          tag.appendChild(document.createTextNode(tt));

          this.parentElement.insertBefore(tag, this);

          this.remove();

          let ot = this.dataset.tag;

          let oldtags = document.querySelectorAll('.keytag[data-tag="' + ot + '"]');
          console.log(oldtags);

          for(var i=0;i<oldtags.length;i++){
            let to = oldtags[i];
            to.empty();
            to.appendChild(document.createTextNode(tt));
            to.dataset.tag = tt;
          }

          KEYTAGS.push({color: '#ddd', tcolor: '#000', text: tt});
        } else if ( e.keyCode == 27 ){
          this.getparent('list').remove();
        }
      }

      l.appendChild(t);
      l.appendChild(m);

      c.appendChild(l);

      let cc = document.getElementById('container');

      cc.scrollLeft = cc.scrollWidth;

      t.focus();
    }

    function addktpop(e){

      this.getElementsByClassName('popover').remove();

      let ktp = makektpop();

      this.appendChild(ktp);
    }

    function changetagcolor(e){
      let c = window.getComputedStyle(this).backgroundColor;

      console.log(c);

      let t = this.getparent('listtag');
      let k = t.dataset.tag;

      let object = KEYTAGS.find(x => x.text === k);
      var foundIndex = KEYTAGS.findIndex(x => x.text == k);

      let rgb = string2rgb(c);
      console.log(rgb);
      let w = contrastrrgb(rgb, [255,255,255]);
      let b = contrastrrgb(rgb, [0,0,0]);

      let tx = w > b ? 'white': 'black';

      KEYTAGS[foundIndex].color = c;
      KEYTAGS[foundIndex].tcolor = tx;

      t.style.backgroundColor = c;
      t.style.color = tx;

      let kts = document.getElementsByClassName('keytag');

      for(var i=0;i<kts.length;i++){
        let kk = kts[i];
        let tag = kk.dataset.tag || kk.innerText;
        console.log(tag.toLowerCase(), k, tag.toLowerCase() == k)
        if ( tag.toLowerCase() == k){
          kk.style.backgroundColor = c;
          kk.style.color = tx;

          let dc = kk.getparent('dragcard');
          if ( dc ){
            dc.style.backgroundColor = c;
            dc.style.color = tx;
          }
        }
      }
    }

    function string2rgb(x){
      let rgb = [];
      if ( x.indexOf('rgba') >= 0 ){
        rgb = x.replace('rgba(', '').replace(')', '');
        rgb = rgb.split(',');

      } else if ( x.indexOf('rgb') >= 0 ){
        rgb = x.replace('rgb(', '').replace(')', '');
        rgb = rgb.split(',');

        if ( rgb.length == 1 ){
          rgb = rgb.split(' ');
        }
        

      } else if ( x.indexOf('#') >= 0 ){
        rgb = hex2rgb(bg);
      }

      return rgb;
    }

      function removebounding(e){
          var bb = document.getElementsByClassName('boundingbox');

          while(bb[0]){
              // bb[0].object.bounds = null;

              // console.log(bb[0].object);
              // bb[0].object['bounds'] = null;
              // console.log(bb[0].object['bounds']);

              // delete bb[0].object.bounds;
              bb[0].parentNode.removeChild(bb[0]);
          }

          document.getElementsByClassName('dragcard selected').removeclass('selected');
      }

    function marquee(e){
      if ( e.which == 3 || !e.target.classList.contains('scratchpad') ){
          return;
      }

      // e.preventDefault();
      removebounding();
      // blurall();

      var sx = e.clientX;
      var sy = e.clientY;

      //var sh = window.scrollTop || document.body.scrollTop || document.scrollTop;

      var just = this;
      var marq = document.createElement('div');

      marq.style.border = '1px solid #1473e6';
      marq.style.position = 'absolute';
      marq.style.top = sy +'px';
      marq.style.left = sx + 'px';
      marq.style.zIndex = 133333333333333333333333333337;
      marq.style.background = 'rgba(20, 115, 230,.15)';

      marq.className = 'marquee';


      //document.body.appendChild(marq);
      var moved = false;

      function move(e){
          e.preventDefault();
          e.stopPropagation();

          var x = e.clientX;
          var y = e.clientY;
          var nx = x - sx;
          var ny = y - sy;

          if ( !moved ){
            if ( Math.abs(nx) < 4 && Math.abs(ny) < 4 ){
              return;
            }
            moved = true;
            document.body.appendChild(marq);
          }

          var w = Math.abs(nx);
          var h = Math.abs(ny);

          marq.style.width = w + 'px';
          marq.style.height = h + 'px';

          var tx = nx < 0 ? nx : 0;
          var ty = ny < 0 ? ny : 0;

          marq.style.transform = 'translate(' + tx + 'px, ' + ty + 'px)';


          var coords = marq.getBoundingClientRect();
          var ml = coords.left;
          //var mr = coords.right;
          //var mb = coords.bottom;
          var mt = coords.top;
          var mh = coords.height;
          var mw = coords.width;

          var elms = just.getElementsByClassName('dragcard');

          for(var i=0;i<elms.length;i++){
              var elm = elms[i];
              // var ol = elm.offsetLeft + elm.parentNode.offsetLeft + elm.parentNode.parentNode.offsetLeft  + Number(elm.dataset.x);
              // var ot = elm.parentNode.offsetTop + Number(elm.dataset.y) + 52;
              var bounds = elm.getBoundingClientRect();
              var ol = bounds.left;
              var ot = bounds.top;
              //var ob = bounds.bottom;
              //var or = bounds.right;
              // var ew = elm.offsetWidth;
              // var eh = elm.offsetHeight;
              var oh = bounds.height;
              var ow = bounds.width;

                  var x1 = ml;
                  var x2 = ml + mw;
                  var y1 = mt;
                  var y2 = mt + mh;

                  var ox1 = ol;
                  var ox2 = ol + ow;
                  var oy1 = ot;
                  var oy2 = ot + oh;

              if ( (y2 < oy1 ) || (y1 > oy2) || (x2 < ox1) || (x1 > ox2) ){
                elm.classList.remove('selected')
              } else {
                elm.classList.add('selected');
              }
          }

          var boxes = just.getElementsByClassName('dragcard selected');

          if ( !boxes.length ){
            return;
          } else if ( boxes.length === 1){
            setboundingbox.call(boxes[0], e);
          } else {
            setmultibounds.call(boxes, e);
          }
      }

      function end(e){
        e.preventDefault();
        e.stopPropagation();

        window.removeEventListener('mousemove', move);
        window.removeEventListener('mouseup', end);

          if ( moved ){
            setTimeout(function(){marq.remove();}, 100);
          }
      }

      window.addEventListener('mouseup', end);
      window.addEventListener('mousemove', move);
  }

  function setboundingbox(e){
    if ( !!this.bounds ){

      var bb = document.getElementsByClassName('boundingbox');

          while(bb[0]){

              bb[0].parentNode.removeChild(bb[0]);
          }
    }

    var off = this.offset();

    var x = off.x;
    var y = off.y;
    var w = off.w;
    var h = off.h;

    var b = document.createElement('div');
    var handles = document.createElement('div');
    // var hitbox = document.createElement('div');

    b.className = 'boundingbox';

    // hitbox.className = 'hitbox';

    b.object = [this];

    this.bounds = b;

    b.style.left = x + 'px';
    b.style.top = y + 'px';
    b.style.position = 'absolute';
    b.style.width = w + 'px';
    b.style.height = h + 'px';
    b.style.zIndex = 2147483640;

    if ( h <= 72 ){
      b.classList.add('minheight');
    } else {
      b.classList.remove('minheight');
    }

    if ( w <= 72 ){
      b.classList.add('minwidth');
    } else {
      b.classList.remove('minwidth');
    }

    if ( this.classList.contains('canvasboard') ){
      b.style.boxShadow = 'none';
    }

    for(var i=0;i<8;i++){
      var a = document.createElement('div');
      a.className = 'bhandle';

      handles.appendChild(a);
    }

    b.appendChild(handles);
    // b.appendChild(hitbox);

    document.body.appendChild(b);
  }

    function setboundingposition(e){
      var b = document.getElementsByClassName('boundingbox')[0];

      if ( !b ){
        return;
      }

      var s = document.getElementsByClassName('dragcard selected');

      var tx = null;
      var ty = null;
      var tw = null;
      var th = null;

      b.object = [];

      for(var i=0;i<s.length;i++){
        var r = s[i];
        var off = r.offset();

        var x = off.x;
        var y = off.y;
        var w = off.w;
        var h = off.h;

        var x2 = x + w;
        var y2 = y + h;

        if ( !tx || x < tx){
          tx = x;
        }

        if ( !ty || y < ty){
          ty = y;
        }

        if ( !tw || x2 > tw ){
          tw = x2;
        }

        if ( !th || y2 > th){
          th = y2;
        }

        r.bounds = b;

        b.object.push(r);
      }

      var nw = tw - tx;
      var nh = th - ty;

      b.style.left = tx + 'px';
      b.style.top = ty + 'px';
      b.style.position = 'absolute';
      b.style.width = nw + 'px';
      b.style.height = nh + 'px';
      b.style.zIndex = 2147483641;

      if ( nh <= 72 ){
        b.classList.add('minheight');
      } else {
        b.classList.remove('minheight');
      }

      if ( nw <= 72 ){
        b.classList.add('minwidth');
      } else {
        b.classList.remove('minwidth');
      }
    }

    function setmultibounds(e){
      var s = this;

      var t = this[0];

      var b = document.getElementsByClassName('multibox')[0];

      if ( !b ){
        var b = document.createElement('div');
        b.className = 'boundingbox multibox';

        for(var i=0;i<4;i++){
          var a = document.createElement('div');
          a.className = 'bhandle';

          b.appendChild(a);
        }

        var o = document.getElementsByClassName('boundingbox');
        o.remove();

        document.body.appendChild(b);
      }

      var tx = null;
      var ty = null;
      var tw = null;
      var th = null;

      b.object = [];

      for(var i=0;i<s.length;i++){
        var r = s[i];
        var off = r.offset();

        var x = off.x;
        var y = off.y;
        var w = off.w;
        var h = off.h;

        var x2 = x + w;
        var y2 = y + h;

        if ( !tx || x < tx){
          tx = x;
        }

        if ( !ty || y < ty){
          ty = y;
        }

        if ( !tw || x2 > tw ){
          tw = x2;
        }

        if ( !th || y2 > th){
          th = y2;
        }

        r.bounds = b;

        b.object.push(r);
      }    

      b.style.left = tx + 'px';
      b.style.top = ty + 'px';
      b.style.position = 'absolute';
      b.style.width = tw - tx + 'px';
      b.style.height = th - ty + 'px';
      b.style.zIndex = 999999999999999;

    }

    function insertboard(e){
      let cv = document.getElementsByClassName('view show')[0];
      let sp = cv.getElementsByClassName('scratchpad')[0];

      let s = document.createElement('section');
      let c = document.createElement('div');
      let b = document.createElement('div');
      let r = document.createElement('div');

      s.style.display = 'flex';
      s.style.padding = '20px';
      s.style.background = 'var(--ui2)';
      s.style.overflow = 'auto hidden';
      
      
      c.className = 'listcontainer';
      c.style.flexWrap = 'wrap';

      b.className = 'btn listbtn addlist';
      b.appendChild(document.createTextNode('Add list'));

      r.className = 'spacer';

      newlist.call(c)
      s.appendChild(c);
      s.appendChild(b);
      s.appendChild(r);

      sp.appendChild(s);
    }

    Attach.on('dragstart', '.card', dragStart);

    Attach.on('dragover', '.list, .slide, .scratchpad', handleDragOver);
    Attach.on('dragenter', '.list', handleDragEnter);
    Attach.on('dragleave', '.list', handleDragLeave);
    Attach.on('dragend', '.list', handleDragEnd);
    Attach.on('drop', '.list, .slide, .scratchpad', handleDrop);

    Attach.on('click', '.xbtn', closetab);
    Attach.on('click', '.ktitem', ktitem);
    Attach.on('click', '.popcard', cardclick);
    Attach.on('click', '.deletecards', deletecards);
    Attach.on('click', '.deletecard', deletecard);
    Attach.on('mousedown', '.card', carddrag);
    Attach.on('mousedown', '.dragcard', carddrag);
    Attach.on('dblclick', '.dragcard', carddb);
    Attach.on('click', '.toggle', togglebtn);
    Attach.on('click', '.pop', popbtn);
    // Attach.on('click', '.tab', tab);
    Attach.on('click', '#wrapper', bodyclick);
    Attach.on('click', '.minbtn', minbtn);
    Attach.on('input', '.searchbar', filtercards);
    Attach.on('input', '.ctoggle', ctoggle);
    Attach.on('input', '.cradio', cradio);
    Attach.on('input', 'textarea', ta);
    Attach.on('input', '.selectall', selectall);
    Attach.on('click', '.lockbtn', lockbtn);
    Attach.on('click', '.commentbtn', commentbtn);
    Attach.on('click', '.activitybtn', activitybtn);
    Attach.on('click', '.closebtn', closebtn);
    Attach.on('mousedown', '.list', draglist);
    Attach.on('mousedown', '.tab', dragtab);
    Attach.on('click', '.popout', popout);
    Attach.on('mousedown', '.dragscroll', dragscroll);
    Attach.on('click', '.planswapbtn', planswap);
    Attach.on('click', '.newplanbtn', newplan);
    Attach.on('click', '.newboardbtn', newboard);
    Attach.on('click', '.newtimelinebtn', newtimeline);
    Attach.on('click', '.newcebtn', newce);
    Attach.on('click', '.newbriefbtn', newbrief);
    Attach.on('click', '.newordersbtn', neworders);
    Attach.on('click', '.newscratchbtn', newscratch);
    Attach.on('mousedown', '#resizecl', resizecl);
    Attach.on('blur', '.mr', blurmr);
    Attach.on('keydown', '.mr', sanitizeContenteditable);
    Attach.on('keyup', '.mr', mrup);
    Attach.on('click', '.addlist', addlist);
    Attach.on('click', '.tagdrop', addktpop);
    Attach.on('click', '.coloritem', changetagcolor);
    Attach.on('mousedown', '.scratchpad', marquee);
    Attach.on('click', '.insertboard', insertboard);
    
    document.addEventListener('keyup', keypress);

    makekeytags();
    makecards(40);
    restorecustom();
    popcorn();

    newboard();

    if ( localStorage.opennew){
      document.getElementById('openpopwindow').classList.add('opened');
    }
  </script>
</body>
</html>
